{"id":"cc-top-0lq","title":"Fix j/k key binding conflict for event scrolling","description":"tui/keys.go binds both Up/Down and ScrollUp/ScrollDown to j/k keys. In handleDashboardKey(), Up/Down are checked before ScrollUp/ScrollDown, so pressing j/k always triggers session navigation, never event scrolling. Manual event scrolling via j/k is unreachable. Fix: use separate key bindings for event scrolling (e.g., Ctrl+J/Ctrl+K, or PgUp/PgDn, or dedicated scroll keys when event panel is focused).","status":"closed","priority":2,"issue_type":"bug","owner":"riabtchuk@gmail.com","created_at":"2026-02-15T04:22:01Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T04:43:26Z","closed_at":"2026-02-15T04:43:26Z","close_reason":"Fixed by parallel agent team"}
{"id":"cc-top-8he","title":"Fix loop detector duplicate event accumulation","description":"alerts/rules.go loopDetectorRule.Evaluate() re-processes ALL events from the store every evaluation cycle. Events already processed and added to r.failures get re-appended, causing duplicate timestamps. A single failure gets counted N times (N = number of eval cycles since event added). Loop detector fires prematurely/incorrectly. Fix: track last-processed event index or timestamp to skip already-seen events.","status":"closed","priority":1,"issue_type":"bug","owner":"riabtchuk@gmail.com","created_at":"2026-02-15T04:21:44Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T04:43:26Z","closed_at":"2026-02-15T04:43:26Z","close_reason":"Fixed by parallel agent team"}
{"id":"cc-top-a95","title":"Task Graph: /Users/nixlim/Sync/PROJECTS/foundry_zero/cc-top/.tasks/telemetry-enhancements.task.json","status":"closed","priority":1,"issue_type":"epic","owner":"riabtchuk@gmail.com","created_at":"2026-02-15T06:06:19Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T15:08:55Z","closed_at":"2026-02-15T15:08:55Z","close_reason":"All 21 child tasks implemented and tested by team of 5 agents"}
{"id":"cc-top-a95.1","title":"Extract cache tokens from api_request events","description":"The store captures cache_read_tokens and cache_creation_tokens from api_request event attributes and stores them as numeric fields in SessionData.\n\n## Inputs\n- **api_request_event** (`state.Event`): Name == claude_code.api_request -- Source: OTLP log records via receiver\n\n## Outputs\n- **cache_read_tokens** (`int64`): \u003e= 0 -- Dest: SessionData field\n- **cache_creation_tokens** (`int64`): \u003e= 0 -- Dest: SessionData field\n\n## Constraints\n- Must not break existing api_request event processing\n- Must handle missing or malformed cache token values gracefully\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"extract-cache-tokens\",\"files_scope\":[\"internal/state/types.go\",\"internal/state/store.go\",\"internal/state/store_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"api_request_event\",\"type\":\"state.Event\",\"constraints\":\"Name == claude_code.api_request\",\"source\":\"OTLP log records via receiver\"}],\"outputs\":[{\"name\":\"cache_read_tokens\",\"type\":\"int64\",\"constraints\":\"\\u003e= 0\",\"destination\":\"SessionData field\"},{\"name\":\"cache_creation_tokens\",\"type\":\"int64\",\"constraints\":\"\\u003e= 0\",\"destination\":\"SessionData field\"}]}}","acceptance_criteria":"- SessionData has CacheReadTokens and CacheCreationTokens int64 fields\n- When an api_request event with cache_read_tokens=5000 is added, GetSession returns CacheReadTokens \u003e= 5000\n- When an api_request event with cache_creation_tokens=2000 is added, GetSession returns CacheCreationTokens \u003e= 2000\n- Events without cache token attributes leave the fields unchanged at 0\n- go test ./internal/state/... passes with 0 failures","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T06:06:20Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T15:06:54Z","closed_at":"2026-02-15T15:06:54Z","close_reason":"Implemented by team agents"}
{"id":"cc-top-a95.10","title":"Aggregate tool execution performance metrics","description":"The stats calculator computes average and P95 duration_ms per tool_name from tool_result events and exposes the results in DashboardStats.\n\n## Inputs\n- **tool_result_events** (`list\u003cstate.Event\u003e`): Name == claude_code.tool_result, has tool_name and duration_ms attributes -- Source: State store events\n\n## Outputs\n- **tool_perf** (`list\u003cToolPerf\u003e`): One entry per tool_name with avg and p95 duration -- Dest: DashboardStats struct\n\n## Constraints\n- Must not degrade stats computation for large event counts\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"aggregate-tool-execution-perf\",\"files_scope\":[\"internal/stats/types.go\",\"internal/stats/calculator.go\",\"internal/stats/calculator_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"tool_result_events\",\"type\":\"list\\u003cstate.Event\\u003e\",\"constraints\":\"Name == claude_code.tool_result, has tool_name and duration_ms attributes\",\"source\":\"State store events\"}],\"outputs\":[{\"name\":\"tool_perf\",\"type\":\"list\\u003cToolPerf\\u003e\",\"constraints\":\"One entry per tool_name with avg and p95 duration\",\"destination\":\"DashboardStats struct\"}]}}","acceptance_criteria":"- DashboardStats includes a ToolPerformance []ToolPerf field with ToolName, AvgDurationMS, P95DurationMS float64 fields\n- Given 20 tool_result events for Bash with durations [100..2000], AvgDurationMS is within 5% of the actual mean\n- P95DurationMS for a tool with 100 samples is \u003e= the 95th sample when sorted\n- Tools with no duration_ms attribute are excluded from performance stats\n- go test ./internal/stats/... passes with 0 failures","status":"closed","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T06:06:26Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T15:08:30Z","closed_at":"2026-02-15T15:08:30Z","close_reason":"Implemented by team agents"}
{"id":"cc-top-a95.11","title":"Track session.count metric for session detection","description":"The state store recognizes claude_code.session.count metrics and creates session entries upon receiving the first such metric, before any other data arrives.\n\n## Inputs\n- **session_count_metric** (`state.Metric`): Name == claude_code.session.count -- Source: OTLP metrics via receiver\n\n## Outputs\n- **session_entry** (`SessionData`): Created with StartedAt set to metric timestamp -- Dest: State store\n\n## Constraints\n- Must not affect existing session creation behavior for other metrics\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"track-session-count-metric\",\"files_scope\":[\"internal/state/store.go\",\"internal/state/store_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"session_count_metric\",\"type\":\"state.Metric\",\"constraints\":\"Name == claude_code.session.count\",\"source\":\"OTLP metrics via receiver\"}],\"outputs\":[{\"name\":\"session_entry\",\"type\":\"SessionData\",\"constraints\":\"Created with StartedAt set to metric timestamp\",\"destination\":\"State store\"}]}}","acceptance_criteria":"- When a session.count metric with session.id=abc123 arrives as the first data for that session, GetSession(abc123) returns a non-nil SessionData\n- The SessionData.StartedAt is set to the metric timestamp, not time.Now()\n- Subsequent metrics and events for the same session still function correctly\n- go test ./internal/state/... passes with 0 failures","status":"closed","priority":3,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":15,"created_at":"2026-02-15T06:06:27Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T15:06:55Z","closed_at":"2026-02-15T15:06:55Z","close_reason":"Implemented by team agents"}
{"id":"cc-top-a95.12","title":"Extract speed (fast mode) attribute from events and metrics","description":"SessionData tracks whether a session is using fast mode based on the speed attribute present on events and metrics.\n\n## Inputs\n- **events_and_metrics** (`union(state.Event, state.Metric)`): May have speed attribute -- Source: State store\n\n## Outputs\n- **fast_mode** (`bool`): true when speed attribute present and non-empty -- Dest: SessionData.FastMode field\n\n## Constraints\n- Must be set from the most recent event/metric, not toggled permanently\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"extract-speed-attribute\",\"files_scope\":[\"internal/state/types.go\",\"internal/state/store.go\",\"internal/state/store_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"events_and_metrics\",\"type\":\"union(state.Event, state.Metric)\",\"constraints\":\"May have speed attribute\",\"source\":\"State store\"}],\"outputs\":[{\"name\":\"fast_mode\",\"type\":\"bool\",\"constraints\":\"true when speed attribute present and non-empty\",\"destination\":\"SessionData.FastMode field\"}]}}","acceptance_criteria":"- SessionData has a FastMode bool field\n- When an event with speed=fast attribute arrives, GetSession returns FastMode == true\n- When no speed attribute is present on any event, FastMode remains false\n- go test ./internal/state/... passes with 0 failures","status":"closed","priority":3,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":15,"created_at":"2026-02-15T06:06:27Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T15:06:55Z","closed_at":"2026-02-15T15:06:55Z","close_reason":"Implemented by team agents"}
{"id":"cc-top-a95.13","title":"Extract org and user identity attributes","description":"SessionData stores organization.id and user.account_uuid from OTLP resource or event attributes as identity metadata.\n\n## Inputs\n- **resource_or_event_attrs** (`map\u003cstring, string\u003e`): May contain organization.id and user.account_uuid keys -- Source: OTLP resource attributes or event attributes\n\n## Outputs\n- **org_id** (`string`): Empty if not present -- Dest: SessionData.OrgID field\n- **user_uuid** (`string`): Empty if not present -- Dest: SessionData.UserUUID field\n\n## Constraints\n- Must extract from resource attributes with same precedence as session.id\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"extract-org-user-identity\",\"files_scope\":[\"internal/state/types.go\",\"internal/state/store.go\",\"internal/state/store_test.go\",\"internal/receiver/receiver.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"resource_or_event_attrs\",\"type\":\"map\\u003cstring, string\\u003e\",\"constraints\":\"May contain organization.id and user.account_uuid keys\",\"source\":\"OTLP resource attributes or event attributes\"}],\"outputs\":[{\"name\":\"org_id\",\"type\":\"string\",\"constraints\":\"Empty if not present\",\"destination\":\"SessionData.OrgID field\"},{\"name\":\"user_uuid\",\"type\":\"string\",\"constraints\":\"Empty if not present\",\"destination\":\"SessionData.UserUUID field\"}]}}","acceptance_criteria":"- SessionData has OrgID and UserUUID string fields\n- When OTLP payload has resource attribute organization.id=org_abc, GetSession returns OrgID == org_abc\n- When OTLP payload has resource attribute user.account_uuid=usr_xyz, GetSession returns UserUUID == usr_xyz\n- When attributes are absent, fields remain empty strings\n- go test ./internal/state/... passes with 0 failures\n- go test ./internal/receiver/... passes with 0 failures","status":"closed","priority":3,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T06:06:28Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T15:06:55Z","closed_at":"2026-02-15T15:06:55Z","close_reason":"Implemented by team agents"}
{"id":"cc-top-a95.14","title":"Parse MCP server and tool names from tool_parameters JSON","description":"The event formatter and stats calculator extract mcp_server_name, mcp_tool_name, and skill_name from tool_parameters JSON when OTEL_LOG_TOOL_DETAILS is enabled.\n\n## Inputs\n- **tool_result_events** (`list\u003cstate.Event\u003e`): Has tool_parameters attribute containing JSON with mcp_server_name, mcp_tool_name, or skill_name -- Source: State store events\n\n## Outputs\n- **mcp_stats** (`map\u003cstring, int\u003e`): Keys are mcp_server_name:mcp_tool_name, values are counts -- Dest: DashboardStats struct\n- **formatted_events** (`list\u003cFormattedEvent\u003e`): Include MCP/skill info in display string -- Dest: Event stream\n\n## Constraints\n- Must not break existing bash_command extraction in alerts/rules.go loop detector\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"parse-mcp-tool-names\",\"files_scope\":[\"internal/events/formatter.go\",\"internal/events/formatter_test.go\",\"internal/stats/types.go\",\"internal/stats/calculator.go\",\"internal/stats/calculator_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"tool_result_events\",\"type\":\"list\\u003cstate.Event\\u003e\",\"constraints\":\"Has tool_parameters attribute containing JSON with mcp_server_name, mcp_tool_name, or skill_name\",\"source\":\"State store events\"}],\"outputs\":[{\"name\":\"mcp_stats\",\"type\":\"map\\u003cstring, int\\u003e\",\"constraints\":\"Keys are mcp_server_name:mcp_tool_name, values are counts\",\"destination\":\"DashboardStats struct\"},{\"name\":\"formatted_events\",\"type\":\"list\\u003cFormattedEvent\\u003e\",\"constraints\":\"Include MCP/skill info in display string\",\"destination\":\"Event stream\"}]}}","acceptance_criteria":"- When tool_parameters JSON contains mcp_server_name=github and mcp_tool_name=create_issue, the formatted event includes github:create_issue\n- DashboardStats includes an MCPToolUsage map[string]int field\n- When tool_parameters lacks MCP fields, behavior is unchanged from current\n- The existing bash_command extraction for loop detection still functions correctly\n- go test ./internal/events/... passes with 0 failures\n- go test ./internal/stats/... passes with 0 failures","status":"closed","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T06:06:29Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T15:08:30Z","closed_at":"2026-02-15T15:08:30Z","close_reason":"Implemented by team agents"}
{"id":"cc-top-a95.15","title":"Compute API latency percentiles P50 P95 P99","description":"The stats calculator computes P50, P95, and P99 latency percentiles from api_request duration_ms values and exposes them in DashboardStats alongside the existing average.\n\n## Inputs\n- **api_request_events** (`list\u003cstate.Event\u003e`): Name == claude_code.api_request, has duration_ms attribute -- Source: State store events\n\n## Outputs\n- **latency_percentiles** (`LatencyPercentiles struct`): Fields: P50, P95, P99 as float64 in seconds -- Dest: DashboardStats struct\n\n## Constraints\n- Must use sort-based percentile calculation, not approximate\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"compute-api-latency-percentiles\",\"files_scope\":[\"internal/stats/types.go\",\"internal/stats/calculator.go\",\"internal/stats/calculator_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"api_request_events\",\"type\":\"list\\u003cstate.Event\\u003e\",\"constraints\":\"Name == claude_code.api_request, has duration_ms attribute\",\"source\":\"State store events\"}],\"outputs\":[{\"name\":\"latency_percentiles\",\"type\":\"LatencyPercentiles struct\",\"constraints\":\"Fields: P50, P95, P99 as float64 in seconds\",\"destination\":\"DashboardStats struct\"}]}}","acceptance_criteria":"- DashboardStats includes a LatencyPercentiles struct with P50, P95, P99 float64 fields in seconds\n- Given 100 api_request events with duration_ms linearly from 100 to 10000, P50 is within 10% of 5050ms converted to seconds\n- P95 \u003e= P50 and P99 \u003e= P95 for any non-trivial dataset\n- When no api_request events exist, all percentiles are 0\n- go test ./internal/stats/... passes with 0 failures","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T06:06:29Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T15:08:30Z","closed_at":"2026-02-15T15:08:30Z","close_reason":"Implemented by team agents"}
{"id":"cc-top-a95.16","title":"Add per-session cost threshold alerts","description":"The alert engine fires a per-session CostSurge alert when any individual session's cost exceeds a configurable threshold, in addition to the existing global CostSurge alert.\n\n## Inputs\n- **session_costs** (`list\u003cSessionData\u003e`): Each has TotalCost \u003e= 0 -- Source: State store sessions\n- **threshold** (`f64`): \u003e 0 -- Source: Config AlertsConfig\n\n## Outputs\n- **session_cost_alerts** (`list\u003cAlert\u003e`): Rule == CostSurge, SessionID non-empty -- Dest: Alert engine output\n\n## Constraints\n- Must reuse existing alert deduplication logic\n- Must not fire for sessions below the threshold\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"per-session-cost-alerts\",\"files_scope\":[\"internal/alerts/rules.go\",\"internal/alerts/engine.go\",\"internal/alerts/engine_test.go\",\"internal/config/config.go\",\"internal/config/defaults.go\",\"internal/config/config_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"session_costs\",\"type\":\"list\\u003cSessionData\\u003e\",\"constraints\":\"Each has TotalCost \\u003e= 0\",\"source\":\"State store sessions\"},{\"name\":\"threshold\",\"type\":\"f64\",\"constraints\":\"\\u003e 0\",\"source\":\"Config AlertsConfig\"}],\"outputs\":[{\"name\":\"session_cost_alerts\",\"type\":\"list\\u003cAlert\\u003e\",\"constraints\":\"Rule == CostSurge, SessionID non-empty\",\"destination\":\"Alert engine output\"}]}}","acceptance_criteria":"- AlertsConfig has a SessionCostThreshold float64 field configurable via TOML\n- When a session's TotalCost exceeds the threshold, an alert fires with the session's ID\n- The alert message includes the session ID and the cost amount\n- The global CostSurge alert continues to function unchanged\n- go test ./internal/alerts/... passes with 0 failures\n- go test ./internal/config/... passes with 0 failures","status":"closed","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T06:06:30Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T15:06:26Z","closed_at":"2026-02-15T15:06:26Z","close_reason":"Implemented by alerts-config-worker agent"}
{"id":"cc-top-a95.17","title":"Implement cost forecasting with daily and monthly projection","description":"The burn rate calculator produces daily and monthly cost projections extrapolated from the current hourly rate trend, exposed in BurnRate for TUI display.\n\n## Inputs\n- **hourly_rate** (`f64`): \u003e= 0 -- Source: BurnRate.HourlyRate\n- **trend** (`TrendDirection`): TrendFlat, TrendUp, or TrendDown -- Source: BurnRate.Trend\n\n## Outputs\n- **daily_projection** (`f64`): \u003e= 0, in USD -- Dest: BurnRate.DailyProjection\n- **monthly_projection** (`f64`): \u003e= 0, in USD -- Dest: BurnRate.MonthlyProjection\n\n## Constraints\n- Projections use simple linear extrapolation (hourly * 24 / hourly * 720)\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"cost-forecasting\",\"files_scope\":[\"internal/burnrate/types.go\",\"internal/burnrate/calculator.go\",\"internal/burnrate/calculator_test.go\",\"internal/tui/burnrate.go\",\"internal/tui/burnrate_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"hourly_rate\",\"type\":\"f64\",\"constraints\":\"\\u003e= 0\",\"source\":\"BurnRate.HourlyRate\"},{\"name\":\"trend\",\"type\":\"TrendDirection\",\"constraints\":\"TrendFlat, TrendUp, or TrendDown\",\"source\":\"BurnRate.Trend\"}],\"outputs\":[{\"name\":\"daily_projection\",\"type\":\"f64\",\"constraints\":\"\\u003e= 0, in USD\",\"destination\":\"BurnRate.DailyProjection\"},{\"name\":\"monthly_projection\",\"type\":\"f64\",\"constraints\":\"\\u003e= 0, in USD\",\"destination\":\"BurnRate.MonthlyProjection\"}]}}","acceptance_criteria":"- BurnRate struct has DailyProjection and MonthlyProjection float64 fields\n- When HourlyRate is 1.00, DailyProjection == 24.00 and MonthlyProjection == 720.00\n- When HourlyRate is 0, projections are 0\n- The TUI burn rate panel displays the daily and monthly projections\n- go test ./internal/burnrate/... passes with 0 failures","status":"closed","priority":3,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T06:06:31Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T15:08:29Z","closed_at":"2026-02-15T15:08:29Z","close_reason":"Implemented by team agents"}
{"id":"cc-top-a95.18","title":"Add /v1/metrics HTTP endpoint for metric ingestion","description":"The HTTP receiver handles POST /v1/metrics requests and stores received OTLP metrics in the state store, supporting both protobuf and JSON content types.\n\n## Inputs\n- **metrics_request** (`ExportMetricsServiceRequest`): Valid OTLP protobuf or JSON -- Source: HTTP POST /v1/metrics\n\n## Outputs\n- **stored_metrics** (`list\u003cstate.Metric\u003e`): Indexed by session ID -- Dest: State store\n\n## Constraints\n- Must follow same patterns as existing /v1/logs handler\n- Must support both protobuf and JSON content types\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"add-http-metrics-endpoint\",\"files_scope\":[\"internal/receiver/http.go\",\"internal/receiver/http_test.go\",\"internal/receiver/receiver.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"metrics_request\",\"type\":\"ExportMetricsServiceRequest\",\"constraints\":\"Valid OTLP protobuf or JSON\",\"source\":\"HTTP POST /v1/metrics\"}],\"outputs\":[{\"name\":\"stored_metrics\",\"type\":\"list\\u003cstate.Metric\\u003e\",\"constraints\":\"Indexed by session ID\",\"destination\":\"State store\"}]}}","acceptance_criteria":"- POST /v1/metrics with protobuf body returns 200 and metrics appear in state store\n- POST /v1/metrics with JSON body returns 200 and metrics appear in state store\n- GET /v1/metrics returns 405 Method Not Allowed\n- Malformed payloads return 400 with error message\n- Source port is extracted for PID correlation\n- go test ./internal/receiver/... passes with 0 failures","status":"closed","priority":3,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T06:06:31Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T15:08:03Z","closed_at":"2026-02-15T15:08:03Z","close_reason":"Implemented by receiver-worker agent"}
{"id":"cc-top-a95.19","title":"Preserve raw event attributes alongside formatted strings","description":"FormattedEvent stores the original raw attributes map in addition to the pre-formatted display string, enabling future drill-down features.\n\n## Inputs\n- **event** (`state.Event`): Has Attributes map -- Source: FormatEvent function input\n\n## Outputs\n- **raw_attributes** (`map\u003cstring, string\u003e`): Complete copy of event attributes -- Dest: FormattedEvent.RawAttributes field\n\n## Constraints\n- Must not increase memory usage by more than 2x per FormattedEvent\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"preserve-raw-event-attributes\",\"files_scope\":[\"internal/events/types.go\",\"internal/events/formatter.go\",\"internal/events/formatter_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"event\",\"type\":\"state.Event\",\"constraints\":\"Has Attributes map\",\"source\":\"FormatEvent function input\"}],\"outputs\":[{\"name\":\"raw_attributes\",\"type\":\"map\\u003cstring, string\\u003e\",\"constraints\":\"Complete copy of event attributes\",\"destination\":\"FormattedEvent.RawAttributes field\"}]}}","acceptance_criteria":"- FormattedEvent has a RawAttributes map[string]string field\n- After FormatEvent, RawAttributes contains all original event attributes\n- Modifying RawAttributes does not affect the original event (deep copy)\n- Existing Formatted string field is unchanged in format\n- go test ./internal/events/... passes with 0 failures","status":"closed","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T06:06:32Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T15:08:30Z","closed_at":"2026-02-15T15:08:30Z","close_reason":"Implemented by team agents"}
{"id":"cc-top-a95.2","title":"Add per-model cost breakdown to burn rate panel","description":"The burn rate display shows cost split by model name, with each model's hourly rate and total cost visible in the TUI.\n\n## Inputs\n- **cost_usage_metrics** (`list\u003cstate.Metric\u003e`): Name == claude_code.cost.usage, has model attribute -- Source: State store metrics\n- **sessions** (`list\u003cstate.SessionData\u003e`): Non-empty -- Source: State store\n\n## Outputs\n- **per_model_burn** (`list\u003cModelBurnRate\u003e`): One entry per distinct model -- Dest: BurnRate struct and TUI burn rate panel\n\n## Constraints\n- Must not degrade burn rate panel rendering performance\n- Must handle sessions with no model attribute gracefully\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"per-model-cost-in-burnrate\",\"files_scope\":[\"internal/burnrate/types.go\",\"internal/burnrate/calculator.go\",\"internal/burnrate/calculator_test.go\",\"internal/tui/burnrate.go\",\"internal/tui/burnrate_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"cost_usage_metrics\",\"type\":\"list\\u003cstate.Metric\\u003e\",\"constraints\":\"Name == claude_code.cost.usage, has model attribute\",\"source\":\"State store metrics\"},{\"name\":\"sessions\",\"type\":\"list\\u003cstate.SessionData\\u003e\",\"constraints\":\"Non-empty\",\"source\":\"State store\"}],\"outputs\":[{\"name\":\"per_model_burn\",\"type\":\"list\\u003cModelBurnRate\\u003e\",\"constraints\":\"One entry per distinct model\",\"destination\":\"BurnRate struct and TUI burn rate panel\"}]}}","acceptance_criteria":"- BurnRate struct includes a PerModel field containing per-model cost totals\n- When cost.usage metrics arrive with model=claude-sonnet-4-20250514 and model=claude-opus-4-20250514, both appear in burn rate output\n- The TUI burn rate panel renders per-model cost rows below the aggregate rate\n- go test ./internal/burnrate/... passes with 0 failures\n- go test ./internal/tui/... passes with 0 failures","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T06:06:20Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T15:08:29Z","closed_at":"2026-02-15T15:08:29Z","close_reason":"Implemented by team agents"}
{"id":"cc-top-a95.20","title":"Make HighRejection alert threshold configurable","description":"The HighRejection alert rule reads its rejection rate threshold and time window from AlertsConfig instead of using hardcoded values of 50% and 5 minutes.\n\n## Inputs\n- **config** (`AlertsConfig`): Has HighRejectionPercent (1-100) and HighRejectionWindowMinutes (\u003e= 1) -- Source: Config TOML file\n\n## Outputs\n- **configurable_rule** (`highRejectionRule`): Uses config values instead of hardcoded 50% / 5min -- Dest: Alert engine rule set\n\n## Constraints\n- Must maintain backward compatibility with existing config files that lack these keys\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"configurable-high-rejection-threshold\",\"files_scope\":[\"internal/config/config.go\",\"internal/config/defaults.go\",\"internal/config/config_test.go\",\"internal/alerts/rules.go\",\"internal/alerts/engine.go\",\"internal/alerts/engine_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"config\",\"type\":\"AlertsConfig\",\"constraints\":\"Has HighRejectionPercent (1-100) and HighRejectionWindowMinutes (\\u003e= 1)\",\"source\":\"Config TOML file\"}],\"outputs\":[{\"name\":\"configurable_rule\",\"type\":\"highRejectionRule\",\"constraints\":\"Uses config values instead of hardcoded 50% / 5min\",\"destination\":\"Alert engine rule set\"}]}}","acceptance_criteria":"- AlertsConfig has HighRejectionPercent int and HighRejectionWindowMinutes int fields\n- Default values are HighRejectionPercent=50, HighRejectionWindowMinutes=5\n- Setting high_rejection_percent=30 in config.toml causes the alert to fire at 30% rejection rate\n- Setting high_rejection_window_minutes=10 in config.toml uses a 10-minute window\n- Config validation rejects HighRejectionPercent outside 1-100\n- go test ./internal/alerts/... passes with 0 failures\n- go test ./internal/config/... passes with 0 failures","status":"closed","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T06:06:33Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T15:06:26Z","closed_at":"2026-02-15T15:06:26Z","close_reason":"Implemented by alerts-config-worker agent"}
{"id":"cc-top-a95.21","title":"Compute cache savings estimate from cache tokens and pricing","description":"The stats calculator computes estimated cache savings in USD using cache_read_tokens, configured pricing data, and the formula: cache_read_tokens * (input_price - cache_read_price) per million tokens.\n\n## Inputs\n- **cache_read_tokens** (`int64`): \u003e= 0 -- Source: SessionData.CacheReadTokens from extract-cache-tokens task\n- **pricing_config** (`map\u003cstring, [4]float64\u003e`): Model -\u003e [input, output, cache_read, cache_creation] per million -- Source: Config.Pricing\n\n## Outputs\n- **cache_savings_usd** (`f64`): \u003e= 0 -- Dest: DashboardStats.CacheSavingsUSD field\n\n## Constraints\n- Must use pricing data from config, not hardcoded prices\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"compute-cache-savings\",\"files_scope\":[\"internal/stats/types.go\",\"internal/stats/calculator.go\",\"internal/stats/calculator_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"cache_read_tokens\",\"type\":\"int64\",\"constraints\":\"\\u003e= 0\",\"source\":\"SessionData.CacheReadTokens from extract-cache-tokens task\"},{\"name\":\"pricing_config\",\"type\":\"map\\u003cstring, [4]float64\\u003e\",\"constraints\":\"Model -\\u003e [input, output, cache_read, cache_creation] per million\",\"source\":\"Config.Pricing\"}],\"outputs\":[{\"name\":\"cache_savings_usd\",\"type\":\"f64\",\"constraints\":\"\\u003e= 0\",\"destination\":\"DashboardStats.CacheSavingsUSD field\"}]}}","acceptance_criteria":"- DashboardStats includes a CacheSavingsUSD float64 field\n- Given 1M cache_read_tokens for claude-sonnet-4-20250514 with input_price=3.0 and cache_read_price=0.30, CacheSavingsUSD == 2.70\n- When pricing config is absent for a model, that model's cache tokens are excluded from savings\n- When CacheReadTokens is 0, CacheSavingsUSD is 0\n- go test ./internal/stats/... passes with 0 failures","status":"closed","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T06:06:33Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T15:08:30Z","closed_at":"2026-02-15T15:08:30Z","close_reason":"Implemented by team agents"}
{"id":"cc-top-a95.3","title":"Extract and display full token type breakdown","description":"The stats calculator extracts output and cacheCreation token types from token.usage metrics and the TUI displays input/output/cacheRead/cacheCreation breakdown.\n\n## Inputs\n- **token_usage_metrics** (`list\u003cstate.Metric\u003e`): Name == claude_code.token.usage, type attribute in {input, output, cacheRead, cacheCreation} -- Source: State store metrics\n\n## Outputs\n- **token_breakdown** (`map\u003cstring, int64\u003e`): Keys: input, output, cacheRead, cacheCreation -- Dest: DashboardStats struct and TUI stats panel\n\n## Constraints\n- Must not change the existing cacheRead/input handling for CacheEfficiency\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"extract-token-type-breakdown\",\"files_scope\":[\"internal/stats/types.go\",\"internal/stats/calculator.go\",\"internal/stats/calculator_test.go\",\"internal/tui/stats.go\",\"internal/tui/stats_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"token_usage_metrics\",\"type\":\"list\\u003cstate.Metric\\u003e\",\"constraints\":\"Name == claude_code.token.usage, type attribute in {input, output, cacheRead, cacheCreation}\",\"source\":\"State store metrics\"}],\"outputs\":[{\"name\":\"token_breakdown\",\"type\":\"map\\u003cstring, int64\\u003e\",\"constraints\":\"Keys: input, output, cacheRead, cacheCreation\",\"destination\":\"DashboardStats struct and TUI stats panel\"}]}}","acceptance_criteria":"- DashboardStats includes a TokenBreakdown map with keys input, output, cacheRead, cacheCreation\n- computeCacheEfficiency still returns correct values after the change\n- When token.usage metrics with type=output arrive, they appear in TokenBreakdown[output]\n- When token.usage metrics with type=cacheCreation arrive, they appear in TokenBreakdown[cacheCreation]\n- The TUI stats panel renders all four token type counts\n- go test ./internal/stats/... passes with 0 failures","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T06:06:21Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T15:08:30Z","closed_at":"2026-02-15T15:08:30Z","close_reason":"Implemented by team agents"}
{"id":"cc-top-a95.4","title":"Extract resource attributes from OTLP payloads","description":"The receiver extracts service.version, os.type, os.version, and host.arch from OTLP resource attributes and stores them as session metadata.\n\n## Inputs\n- **otlp_resource** (`resourcepb.Resource`): Contains standard resource attributes -- Source: OTLP metric and log payloads\n\n## Outputs\n- **session_metadata** (`SessionMetadata struct`): Fields: ServiceVersion, OSType, OSVersion, HostArch -- Dest: SessionData embedded struct\n\n## Constraints\n- Must not break existing session.id extraction from resource attributes\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"extract-resource-attributes\",\"files_scope\":[\"internal/state/types.go\",\"internal/receiver/receiver.go\",\"internal/receiver/grpc.go\",\"internal/receiver/grpc_test.go\",\"internal/receiver/http.go\",\"internal/receiver/http_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"otlp_resource\",\"type\":\"resourcepb.Resource\",\"constraints\":\"Contains standard resource attributes\",\"source\":\"OTLP metric and log payloads\"}],\"outputs\":[{\"name\":\"session_metadata\",\"type\":\"SessionMetadata struct\",\"constraints\":\"Fields: ServiceVersion, OSType, OSVersion, HostArch\",\"destination\":\"SessionData embedded struct\"}]}}","acceptance_criteria":"- SessionData has a Metadata field with ServiceVersion, OSType, OSVersion, HostArch string fields\n- When an OTLP payload contains resource attribute service.version=1.0.32, GetSession returns Metadata.ServiceVersion == 1.0.32\n- When resource attributes are absent, the fields remain empty strings\n- Both gRPC and HTTP receivers extract resource attributes\n- go test ./internal/state/... passes with 0 failures\n- go test ./internal/receiver/... passes with 0 failures","status":"closed","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T06:06:22Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T15:06:55Z","closed_at":"2026-02-15T15:06:55Z","close_reason":"Implemented by team agents"}
{"id":"cc-top-a95.5","title":"Extract language attribute from code_edit_tool.decision metrics","description":"The stats calculator tracks per-session language breakdown from the language attribute on code_edit_tool.decision metrics and exposes it in DashboardStats.\n\n## Inputs\n- **decision_metrics** (`list\u003cstate.Metric\u003e`): Name == claude_code.code_edit_tool.decision, has language attribute -- Source: State store metrics\n\n## Outputs\n- **language_breakdown** (`map\u003cstring, int\u003e`): Key = language name, value = edit count -- Dest: DashboardStats struct\n\n## Constraints\n- Must not affect existing tool acceptance rate computation\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"extract-language-attribute\",\"files_scope\":[\"internal/stats/types.go\",\"internal/stats/calculator.go\",\"internal/stats/calculator_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"decision_metrics\",\"type\":\"list\\u003cstate.Metric\\u003e\",\"constraints\":\"Name == claude_code.code_edit_tool.decision, has language attribute\",\"source\":\"State store metrics\"}],\"outputs\":[{\"name\":\"language_breakdown\",\"type\":\"map\\u003cstring, int\\u003e\",\"constraints\":\"Key = language name, value = edit count\",\"destination\":\"DashboardStats struct\"}]}}","acceptance_criteria":"- DashboardStats includes a LanguageBreakdown map[string]int field\n- When code_edit_tool.decision metrics with language=TypeScript arrive, LanguageBreakdown[TypeScript] \u003e 0\n- When language attribute is absent, no entry is added to the map\n- go test ./internal/stats/... passes with 0 failures","status":"closed","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T06:06:22Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T15:08:29Z","closed_at":"2026-02-15T15:08:29Z","close_reason":"Implemented by team agents"}
{"id":"cc-top-a95.6","title":"Use event.sequence for correct event ordering","description":"Events stored in SessionData are ordered by the event.sequence attribute when present, falling back to timestamp ordering when absent.\n\n## Inputs\n- **events** (`list\u003cstate.Event\u003e`): May have event.sequence attribute as monotonically increasing integer -- Source: State store events\n\n## Outputs\n- **ordered_events** (`list\u003cstate.Event\u003e`): Sorted by event.sequence (primary) then timestamp (secondary) -- Dest: SessionData.Events\n\n## Constraints\n- Must preserve backward compatibility when event.sequence is absent\n- Must not degrade AddEvent performance beyond O(n log n) for sort\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"extract-event-sequence\",\"files_scope\":[\"internal/state/types.go\",\"internal/state/store.go\",\"internal/state/store_test.go\",\"internal/receiver/receiver.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"events\",\"type\":\"list\\u003cstate.Event\\u003e\",\"constraints\":\"May have event.sequence attribute as monotonically increasing integer\",\"source\":\"State store events\"}],\"outputs\":[{\"name\":\"ordered_events\",\"type\":\"list\\u003cstate.Event\\u003e\",\"constraints\":\"Sorted by event.sequence (primary) then timestamp (secondary)\",\"destination\":\"SessionData.Events\"}]}}","acceptance_criteria":"- state.Event has a Sequence int64 field extracted from the event.sequence attribute\n- When events arrive with event.sequence=3,1,2, ListSessions returns them ordered 1,2,3\n- When events lack event.sequence, they sort by Timestamp as before\n- Events with sequence sort before events without sequence at same timestamp\n- go test ./internal/state/... passes with 0 failures","status":"closed","priority":3,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T06:06:23Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T15:06:54Z","closed_at":"2026-02-15T15:06:54Z","close_reason":"Implemented by team agents"}
{"id":"cc-top-a95.7","title":"Extract source attribute from tool_decision events","description":"The stats calculator aggregates tool decision sources (config, user_permanent, user_temporary, user_abort, user_reject) per session and exposes them in DashboardStats.\n\n## Inputs\n- **tool_decision_events** (`list\u003cstate.Event\u003e`): Name == claude_code.tool_decision, has source attribute -- Source: State store events\n\n## Outputs\n- **decision_sources** (`map\u003cstring, int\u003e`): Key = source value, value = count -- Dest: DashboardStats struct\n\n## Constraints\n- Must not affect existing tool decision formatting in events package\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"extract-tool-decision-source\",\"files_scope\":[\"internal/stats/types.go\",\"internal/stats/calculator.go\",\"internal/stats/calculator_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"tool_decision_events\",\"type\":\"list\\u003cstate.Event\\u003e\",\"constraints\":\"Name == claude_code.tool_decision, has source attribute\",\"source\":\"State store events\"}],\"outputs\":[{\"name\":\"decision_sources\",\"type\":\"map\\u003cstring, int\\u003e\",\"constraints\":\"Key = source value, value = count\",\"destination\":\"DashboardStats struct\"}]}}","acceptance_criteria":"- DashboardStats includes a DecisionSources map[string]int field\n- When tool_decision events with source=config arrive, DecisionSources[config] \u003e 0\n- When tool_decision events with source=user_reject arrive, DecisionSources[user_reject] \u003e 0\n- go test ./internal/stats/... passes with 0 failures","status":"closed","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T06:06:24Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T15:08:29Z","closed_at":"2026-02-15T15:08:29Z","close_reason":"Implemented by team agents"}
{"id":"cc-top-a95.8","title":"Categorize API errors by status_code bucket","description":"The stats calculator buckets api_error events into rate-limit (429), auth-failure (401/403), server-error (5xx), and other categories, exposed in DashboardStats.\n\n## Inputs\n- **api_error_events** (`list\u003cstate.Event\u003e`): Name == claude_code.api_error, has status_code attribute -- Source: State store events\n\n## Outputs\n- **error_categories** (`map\u003cstring, int\u003e`): Keys: rate_limit, auth_failure, server_error, other -- Dest: DashboardStats struct\n\n## Constraints\n- Must handle missing or non-numeric status_code gracefully\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"categorize-api-errors\",\"files_scope\":[\"internal/stats/types.go\",\"internal/stats/calculator.go\",\"internal/stats/calculator_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"api_error_events\",\"type\":\"list\\u003cstate.Event\\u003e\",\"constraints\":\"Name == claude_code.api_error, has status_code attribute\",\"source\":\"State store events\"}],\"outputs\":[{\"name\":\"error_categories\",\"type\":\"map\\u003cstring, int\\u003e\",\"constraints\":\"Keys: rate_limit, auth_failure, server_error, other\",\"destination\":\"DashboardStats struct\"}]}}","acceptance_criteria":"- DashboardStats includes an ErrorCategories map[string]int field\n- An api_error event with status_code=429 increments ErrorCategories[rate_limit]\n- An api_error event with status_code=401 increments ErrorCategories[auth_failure]\n- An api_error event with status_code=503 increments ErrorCategories[server_error]\n- An api_error event with status_code=400 increments ErrorCategories[other]\n- go test ./internal/stats/... passes with 0 failures","status":"closed","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T06:06:24Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T15:08:29Z","closed_at":"2026-02-15T15:08:29Z","close_reason":"Implemented by team agents"}
{"id":"cc-top-a95.9","title":"Track API retry rate from attempt attribute","description":"The stats calculator computes an API retry rate metric from the attempt attribute on api_error events and exposes it in DashboardStats.\n\n## Inputs\n- **api_error_events** (`list\u003cstate.Event\u003e`): Name == claude_code.api_error, has attempt attribute as integer string -- Source: State store events\n\n## Outputs\n- **retry_rate** (`f64`): 0 \u003c= rate \u003c= 1 -- Dest: DashboardStats.RetryRate field\n\n## Constraints\n- Must handle missing or malformed attempt values gracefully\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"track-api-retry-attempts\",\"files_scope\":[\"internal/stats/types.go\",\"internal/stats/calculator.go\",\"internal/stats/calculator_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"api_error_events\",\"type\":\"list\\u003cstate.Event\\u003e\",\"constraints\":\"Name == claude_code.api_error, has attempt attribute as integer string\",\"source\":\"State store events\"}],\"outputs\":[{\"name\":\"retry_rate\",\"type\":\"f64\",\"constraints\":\"0 \\u003c= rate \\u003c= 1\",\"destination\":\"DashboardStats.RetryRate field\"}]}}","acceptance_criteria":"- DashboardStats includes a RetryRate float64 field\n- When 10 api_error events have attempt \u003e= 2 out of 20 total api_error events, RetryRate == 0.5\n- When no api_error events exist, RetryRate == 0\n- go test ./internal/stats/... passes with 0 failures","status":"closed","priority":3,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T06:06:25Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T15:08:29Z","closed_at":"2026-02-15T15:08:29Z","close_reason":"Implemented by team agents"}
{"id":"cc-top-b6t","title":"Fix alert threshold defaults to match spec","description":"config/defaults.go has CostSurgeThresholdPerHour=100.00 (spec says 2.00, 50x too high) and RunawayTokenVelocity=200000 (spec says 50000, 4x too high). These defaults mean alerts practically never fire under normal usage. Fix: set defaults to spec values in defaults.go.","status":"closed","priority":2,"issue_type":"bug","owner":"riabtchuk@gmail.com","created_at":"2026-02-15T04:21:52Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T04:43:26Z","closed_at":"2026-02-15T04:43:26Z","close_reason":"Fixed by parallel agent team"}
{"id":"cc-top-cv7","title":"Fix cumulative counter mishandling in stats calculator","description":"stats/calculator.go computeLinesOfCode() and computeCounterMetric() sum raw metric m.Value across all data points. For cumulative counters, if a session reports commit count as 1, then 2, then 3, this sums to 6 instead of 3. Only the latest value (or delta) should be used. Affects: lines of code, commits, PRs stats.","status":"closed","priority":1,"issue_type":"bug","owner":"riabtchuk@gmail.com","created_at":"2026-02-15T04:21:49Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T04:43:26Z","closed_at":"2026-02-15T04:43:26Z","close_reason":"Fixed by parallel agent team"}
{"id":"cc-top-dzh","title":"Add global config file reading to process scanner","description":"Spec Step 4 of Process Discovery requires reading ~/.claude/settings.json env block and /Library/Application Support/ClaudeCode/managed-settings.json to determine telemetry status for all sessions regardless of per-process env vars. Currently the scanner only reads per-process env vars via KERN_PROCARGS2. A process configured via settings.json (not shell env) shows incorrect 'No telemetry' status until data actually flows. The hasReceivedData override partially masks this but initial classification is wrong.","status":"closed","priority":2,"issue_type":"feature","owner":"riabtchuk@gmail.com","created_at":"2026-02-15T04:21:59Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T04:43:26Z","closed_at":"2026-02-15T04:43:26Z","close_reason":"Fixed by parallel agent team"}
{"id":"cc-top-eho","title":"Task Graph: M1 - Foundation","status":"closed","priority":0,"issue_type":"epic","owner":"riabtchuk@gmail.com","created_at":"2026-02-15T01:46:25Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:32:27Z","closed_at":"2026-02-15T02:32:27Z","close_reason":"All 25 child tasks completed. Full build passes, all tests pass with -race."}
{"id":"cc-top-eho.1","title":"Scaffold Go project structure with module, directories, and main entrypoint","description":"The cc-top Go module is initialized with package layout, main.go entrypoint, and go.mod with core dependencies (Bubble Tea, OTLP, TOML).\n\n## Inputs\n- **spec** (`string`): cc-top-v1-spec.md and cc-top-v1-plan-spec.md -- Source: Project documentation\n\n## Outputs\n- **go_module** (`Go module`): Valid go.mod with module path -- Dest: Project root\n- **directory_structure** (`directories`): Standard Go layout -- Dest: Project root\n\n## Constraints\n- Follow standard Go project layout conventions\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"scaffold-project\",\"files_scope\":[\"go.mod\",\"go.sum\",\"cmd/cc-top/main.go\",\"internal/**\"],\"effects\":\"\",\"inputs\":[{\"name\":\"spec\",\"type\":\"string\",\"constraints\":\"cc-top-v1-spec.md and cc-top-v1-plan-spec.md\",\"source\":\"Project documentation\"}],\"outputs\":[{\"name\":\"go_module\",\"type\":\"Go module\",\"constraints\":\"Valid go.mod with module path\",\"destination\":\"Project root\"},{\"name\":\"directory_structure\",\"type\":\"directories\",\"constraints\":\"Standard Go layout\",\"destination\":\"Project root\"}]}}","acceptance_criteria":"- go.mod exists with module github.com/nixlim/cc-top\n- go build ./... succeeds\n- Directories exist: cmd/cc-top/, internal/config/, internal/state/, internal/receiver/, internal/scanner/, internal/correlator/, internal/settings/, internal/burnrate/, internal/events/, internal/alerts/, internal/stats/, internal/tui/, internal/process/\n- cmd/cc-top/main.go contains a main() function that compiles","status":"closed","priority":0,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T01:46:26Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:14:08Z","closed_at":"2026-02-15T02:14:08Z","close_reason":"Scaffold complete: go.mod, all directories, type stubs, main.go, go build succeeds"}
{"id":"cc-top-eho.10","title":"Implement burn rate calculator with rolling averages and trend detection","description":"The burn rate calculator computes total session cost, rolling 5-minute $/hour rate, trend direction, token velocity, and maps rates to color thresholds.\n\n## Inputs\n- **cost_metrics** (`list\u003cCostMetric\u003e`): Cumulative cost.usage values with timestamps -- Source: State store\n- **token_metrics** (`list\u003cTokenMetric\u003e`): Cumulative token.usage counter values -- Source: State store\n- **thresholds** (`ColorThresholds`): Green below X, yellow below Y, red at Y+ -- Source: Config\n\n## Outputs\n- **burn_rate** (`BurnRate struct`): Total \u003e= 0, rate \u003e= 0 -- Dest: TUI burn rate panel\n\n## Constraints\n- Numerically accurate to within $0.01 for cost and 1 token/minute for velocity\n- Handle counter resets gracefully (negative delta = reset)\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-burn-rate-calculator\",\"files_scope\":[\"internal/burnrate/calculator.go\",\"internal/burnrate/calculator_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"cost_metrics\",\"type\":\"list\\u003cCostMetric\\u003e\",\"constraints\":\"Cumulative cost.usage values with timestamps\",\"source\":\"State store\"},{\"name\":\"token_metrics\",\"type\":\"list\\u003cTokenMetric\\u003e\",\"constraints\":\"Cumulative token.usage counter values\",\"source\":\"State store\"},{\"name\":\"thresholds\",\"type\":\"ColorThresholds\",\"constraints\":\"Green below X, yellow below Y, red at Y+\",\"source\":\"Config\"}],\"outputs\":[{\"name\":\"burn_rate\",\"type\":\"BurnRate struct\",\"constraints\":\"Total \\u003e= 0, rate \\u003e= 0\",\"destination\":\"TUI burn rate panel\"}]}}","acceptance_criteria":"- TotalCost() returns the sum of cost.usage across visible sessions\n- HourlyRate() with $0.25 in last 5 minutes returns $3.00/hr\n- HourlyRate() with $0.00 in last 5 minutes returns $0.00/hr\n- TrendDirection() returns Up when current 5-min window ($0.30) exceeds previous ($0.20)\n- TrendDirection() returns Down when current window is lower than previous\n- TrendDirection() returns Flat when windows are equal\n- ColorForRate($0.25/hr) returns Green with default thresholds\n- ColorForRate($1.00/hr) returns Yellow with default thresholds\n- ColorForRate($2.00/hr) returns Red with default thresholds\n- Custom thresholds from config override defaults\n- TokenVelocity() returns tokens per minute from counter deltas\n- Counter reset (prev $5.00, curr $0.50) treats previous as 0 and calculates from $0.50\n- TestBurnRate_TotalCost passes\n- TestBurnRate_RollingHourly passes\n- TestBurnRate_TrendDirection passes\n- TestBurnRate_ColourThresholds passes\n- TestBurnRate_CustomThresholds passes\n- TestBurnRate_TokenVelocity passes\n- TestBurnRate_CounterReset passes","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:31Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:27:05Z","closed_at":"2026-02-15T02:27:05Z","close_reason":"Closed"}
{"id":"cc-top-eho.11","title":"Implement event formatter for all 5 OTLP event types","description":"The event formatter converts raw OTLP events into display-ready strings with type-specific formatting for user_prompt, tool_result, api_request, api_error, and tool_decision events.\n\n## Inputs\n- **event** (`OTLPEvent`): One of 5 known event types -- Source: State store\n\n## Outputs\n- **formatted** (`FormattedEvent`): Display string with session attribution, type icon, and details -- Dest: Event stream panel\n\n## Constraints\n- Token counts above 1000 display as 'Xk' (e.g., 2100 -\u003e 2.1k)\n- Durations display as seconds with 1 decimal place (e.g., 1200ms -\u003e 1.2s)\n- Cost displays with 2 decimal places prefixed by $ (e.g., $0.03)\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-event-formatter\",\"files_scope\":[\"internal/events/formatter.go\",\"internal/events/formatter_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"event\",\"type\":\"OTLPEvent\",\"constraints\":\"One of 5 known event types\",\"source\":\"State store\"}],\"outputs\":[{\"name\":\"formatted\",\"type\":\"FormattedEvent\",\"constraints\":\"Display string with session attribution, type icon, and details\",\"destination\":\"Event stream panel\"}]}}","acceptance_criteria":"- user_prompt event with prompt_length=342 for sess-abc formats as '[sess-abc] Prompt (342 chars)'\n- tool_result event with tool_name=Bash, success=true, duration_ms=1200 formats as '[session] Bash (1.2s)'\n- tool_result event with tool_name=Edit, success=false, decision=reject formats as '[session] Edit rejected by user'\n- api_request event with model=sonnet-4.5, input_tokens=2100, output_tokens=890, cost_usd=0.03, duration_ms=4200 formats as '[session] sonnet-4.5 -\u003e 2.1k in / 890 out ($0.03) 4.2s'\n- api_error event with status_code=529, error=overloaded, attempt=2 formats as '[session] 529 overloaded (attempt 2)'\n- tool_decision event with tool_name=Write, decision=accept, source=config formats as '[session] Write accepted (config)'\n- TestEventFormat_UserPrompt passes\n- TestEventFormat_ToolResultSuccess passes\n- TestEventFormat_ToolResultReject passes\n- TestEventFormat_APIRequest passes\n- TestEventFormat_APIError passes\n- TestEventFormat_ToolDecision passes","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T01:46:32Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:19:34Z","closed_at":"2026-02-15T02:19:34Z","close_reason":"Closed"}
{"id":"cc-top-eho.12","title":"Implement aggregate statistics calculator for the stats dashboard","description":"The stats calculator computes 9 aggregate metrics (lines of code, commits, PRs, tool acceptance rate, cache efficiency, average API latency, model breakdown, top tools, error rate) from state store data.\n\n## Inputs\n- **state** (`StateStore`): Contains all metrics and events -- Source: State store\n\n## Outputs\n- **stats** (`DashboardStats`): All 9 statistics computed -- Dest: TUI stats dashboard\n\n## Constraints\n- Pure computation from state store data  no side effects\n- Cache efficiency = cacheRead / (input + cacheRead), handle division by zero\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-stats-calculator\",\"files_scope\":[\"internal/stats/calculator.go\",\"internal/stats/calculator_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"state\",\"type\":\"StateStore\",\"constraints\":\"Contains all metrics and events\",\"source\":\"State store\"}],\"outputs\":[{\"name\":\"stats\",\"type\":\"DashboardStats\",\"constraints\":\"All 9 statistics computed\",\"destination\":\"TUI stats dashboard\"}]}}","acceptance_criteria":"- LinesOfCode() with type=added totalling 150 and type=removed totalling 30 returns {Added: 150, Removed: 30}\n- CommitsAndPRs() returns {Commits: 5, PRs: 2} when those counter metrics are present\n- ToolAcceptanceRate() with Edit accept=8, reject=2 returns {Edit: 80%}\n- CacheEfficiency() with cacheRead=80000 and input=20000 returns 80%\n- AvgAPILatency() with 10 api_request events averaging 3500ms returns 3.5s\n- ModelBreakdown() groups cost and tokens by model name\n- TopTools() ranks tools by frequency in descending order\n- ErrorRate() with 100 api_request and 5 api_error events returns 5.0%\n- TestStatsCalc_LinesOfCode passes\n- TestStatsCalc_CacheEfficiency passes\n- TestStatsCalc_ErrorRate passes\n- TestStatsCalc_ToolAcceptRate passes\n- TestStatsCalc_AvgLatency passes","status":"closed","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:32Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:22:33Z","closed_at":"2026-02-15T02:22:33Z","close_reason":"Closed"}
{"id":"cc-top-eho.13","title":"Implement --setup CLI flag for non-interactive telemetry configuration","description":"The cc-top --setup command runs settings merge in non-interactive mode, prints the result, and exits without starting the TUI.\n\n## Inputs\n- **setup_flag** (`bool`): Set via CLI --setup flag -- Source: CLI argument\n\n## Outputs\n- **stdout_message** (`string`): Success, already-configured, or error message -- Dest: stdout\n- **exit_code** (`int`): 0 on success, 1 on error -- Dest: Process exit code\n\n## Constraints\n- Non-interactive mode only  no TUI, no prompts\n- Must exit immediately after merge operation\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-cli-setup-command\",\"files_scope\":[\"cmd/cc-top/main.go\",\"cmd/cc-top/setup.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"setup_flag\",\"type\":\"bool\",\"constraints\":\"Set via CLI --setup flag\",\"source\":\"CLI argument\"}],\"outputs\":[{\"name\":\"stdout_message\",\"type\":\"string\",\"constraints\":\"Success, already-configured, or error message\",\"destination\":\"stdout\"},{\"name\":\"exit_code\",\"type\":\"int\",\"constraints\":\"0 on success, 1 on error\",\"destination\":\"Process exit code\"}]}}","acceptance_criteria":"- cc-top --setup with no existing settings.json creates the file and prints 'Settings written'\n- cc-top --setup with already-configured file prints 'Already configured' and exits 0\n- cc-top --setup with malformed settings.json prints the error and exits 1\n- cc-top --setup does not start the TUI or OTLP receivers\n- cc-top --setup with a differing endpoint value prints a warning and does not overwrite","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T01:46:33Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:22:47Z","closed_at":"2026-02-15T02:22:47Z","close_reason":"Closed"}
{"id":"cc-top-eho.14","title":"Implement telemetry status classifier for Claude Code processes","description":"The classifier reads a process's environment variables and categorizes its telemetry status as one of: Connected, Waiting, Wrong port, Console only, No telemetry, or Unknown.\n\n## Inputs\n- **process_info** (`ProcessInfo`): Must include env vars or EnvReadable=false flag -- Source: Process scanner\n\n## Outputs\n- **status** (`TelemetryStatus`): One of 6 enum values with icon and label -- Dest: Session list display\n\n## Constraints\n- Pure function: classify based on env vars and config only\n- Must compare against configured port, not hardcoded default\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-telemetry-classifier\",\"files_scope\":[\"internal/scanner/classifier.go\",\"internal/scanner/classifier_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"process_info\",\"type\":\"ProcessInfo\",\"constraints\":\"Must include env vars or EnvReadable=false flag\",\"source\":\"Process scanner\"}],\"outputs\":[{\"name\":\"status\",\"type\":\"TelemetryStatus\",\"constraints\":\"One of 6 enum values with icon and label\",\"destination\":\"Session list display\"}]}}","acceptance_criteria":"- Classify returns Connected with checkmark icon when CLAUDE_CODE_ENABLE_TELEMETRY=1 and OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317\n- Classify returns WrongPort with warning icon when CLAUDE_CODE_ENABLE_TELEMETRY=1 and endpoint points to port 9090\n- Classify returns ConsoleOnly with warning icon when CLAUDE_CODE_ENABLE_TELEMETRY=1 and no endpoint is set\n- Classify returns NoTelemetry with X icon when CLAUDE_CODE_ENABLE_TELEMETRY=0 or is absent\n- Classify returns Unknown with question-mark icon when EnvReadable=false\n- The configured gRPC port is used for the 'correct port' check (not hardcoded 4317)\n- TestTelemetryClassifier_Connected passes\n- TestTelemetryClassifier_WrongPort passes\n- TestTelemetryClassifier_ConsoleOnly passes\n- TestTelemetryClassifier_NoTelemetry passes\n- TestTelemetryClassifier_Unknown passes","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T01:46:33Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:23:17Z","closed_at":"2026-02-15T02:23:17Z","close_reason":"Closed"}
{"id":"cc-top-eho.15","title":"Implement PID-to-session correlator using port fingerprinting and timing heuristic","description":"The correlator maps Claude Code PIDs to OTLP session.ids using ephemeral source port tracking as the primary method and a 10-second timing heuristic as fallback.\n\n## Inputs\n- **connection_info** (`ConnectionInfo`): Source IP, source port, session.id from OTLP request -- Source: OTLP receivers\n- **process_list** (`list\u003cProcessInfo\u003e`): PIDs with open socket info -- Source: Process scanner\n\n## Outputs\n- **correlation** (`map\u003cPID, session.id\u003e`): Each PID maps to at most one session.id -- Dest: State store\n\n## Constraints\n- Port fingerprinting is primary; timing heuristic is fallback only\n- Uses proc_pidfdinfo macOS API (//go:build darwin)\n- Must handle race conditions where process exits between scan and correlation\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-pid-session-correlator\",\"files_scope\":[\"internal/correlator/correlator.go\",\"internal/correlator/correlator_test.go\",\"internal/correlator/portmap_darwin.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"connection_info\",\"type\":\"ConnectionInfo\",\"constraints\":\"Source IP, source port, session.id from OTLP request\",\"source\":\"OTLP receivers\"},{\"name\":\"process_list\",\"type\":\"list\\u003cProcessInfo\\u003e\",\"constraints\":\"PIDs with open socket info\",\"source\":\"Process scanner\"}],\"outputs\":[{\"name\":\"correlation\",\"type\":\"map\\u003cPID, session.id\\u003e\",\"constraints\":\"Each PID maps to at most one session.id\",\"destination\":\"State store\"}]}}","acceptance_criteria":"- When PID 4821 has an open socket from ephemeral port 52345 and an OTLP request arrives from port 52345 with session.id='sess-abc', the correlator maps PID 4821 to 'sess-abc'\n- When two PIDs have distinct source ports and sessions, each PID maps to its own session only\n- When port fingerprinting fails and a new PID appears within 10 seconds of a new session.id, the timing heuristic matches them\n- When a PID exits and a new PID starts, the old correlation is preserved as 'Exited' and the new PID gets a new correlation\n- When an OTLP session has no matching PID, it appears as 'PID: ---' in the store\n- Uses proc_pidfdinfo to enumerate open file descriptors for port-to-PID mapping\n- TestCorrelator_PortFingerprint passes\n- TestCorrelator_TimingHeuristic passes\n- TestCorrelator_NoMatch passes\n- TestCorrelator_TwoSessions passes","status":"closed","priority":0,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":480,"created_at":"2026-02-15T01:46:34Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:25:20Z","closed_at":"2026-02-15T02:25:20Z","close_reason":"Closed"}
{"id":"cc-top-eho.16","title":"Implement graceful shutdown with drain, port release, and terminal restore","description":"Pressing q triggers graceful shutdown: stop accepting new connections, drain in-flight OTLP requests within 5 seconds, release ports, and restore the terminal to its original state.\n\n## Inputs\n- **quit_signal** (`KeyMsg`): q key press or SIGINT/SIGTERM -- Source: TUI keyboard or OS signal\n- **receivers** (`list\u003cReceiver\u003e`): gRPC and HTTP receivers -- Source: OTLP receivers\n- **tui_program** (`tea.Program`): Running Bubble Tea program -- Source: TUI\n\n## Outputs\n- **clean_exit** (`bool`): All resources released -- Dest: Process exit\n\n## Constraints\n- Use context.WithTimeout for 5-second drain\n- Register SIGINT/SIGTERM handlers\n- Bubble Tea's alternate screen cleanup must run even on forced exit\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-graceful-shutdown\",\"files_scope\":[\"internal/tui/shutdown.go\",\"cmd/cc-top/main.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"quit_signal\",\"type\":\"KeyMsg\",\"constraints\":\"q key press or SIGINT/SIGTERM\",\"source\":\"TUI keyboard or OS signal\"},{\"name\":\"receivers\",\"type\":\"list\\u003cReceiver\\u003e\",\"constraints\":\"gRPC and HTTP receivers\",\"source\":\"OTLP receivers\"},{\"name\":\"tui_program\",\"type\":\"tea.Program\",\"constraints\":\"Running Bubble Tea program\",\"source\":\"TUI\"}],\"outputs\":[{\"name\":\"clean_exit\",\"type\":\"bool\",\"constraints\":\"All resources released\",\"destination\":\"Process exit\"}]}}","acceptance_criteria":"- Pressing q stops accepting new OTLP connections immediately\n- In-flight OTLP requests are allowed up to 5 seconds to complete\n- After 5-second drain timeout, remaining connections are forcibly closed\n- Ports 4317 and 4318 (or custom) are released and immediately available for reuse\n- Terminal cursor is visible after exit\n- Terminal input echoing is enabled after exit\n- Alternate screen buffer is cleared after exit\n- Exit completes within 6 seconds (5s drain + 1s cleanup)\n- SIGINT and SIGTERM also trigger graceful shutdown\n- TestE2E_GracefulShutdown passes","status":"closed","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T01:46:34Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:30:39Z","closed_at":"2026-02-15T02:30:39Z","close_reason":"Closed"}
{"id":"cc-top-eho.17","title":"Implement alert engine with 7 configurable alert rules","description":"The alert engine evaluates 7 rules (Cost Surge, Runaway Tokens, Loop Detector, Error Storm, Stale Session, Context Pressure, High Rejection Rate) against state store data and fires alerts with configurable thresholds.\n\n## Inputs\n- **state** (`StateStore`): Contains metrics and events indexed by session.id -- Source: State store\n- **config** (`AlertConfig`): Thresholds for each rule -- Source: Config parser\n- **model_limits** (`map\u003cstring, int\u003e`): Model name to context token limit -- Source: Config parser\n\n## Outputs\n- **alerts** (`list\u003cAlert\u003e`): Each alert has rule name, severity, message, session.id (if applicable) -- Dest: TUI alerts panel and system notification\n\n## Constraints\n- Evaluation runs on a configurable interval (default 1 second)\n- Each rule is independently configurable and can be disabled\n- osascript notification uses exec.Command, not CGo\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-alert-engine\",\"files_scope\":[\"internal/alerts/engine.go\",\"internal/alerts/engine_test.go\",\"internal/alerts/rules.go\",\"internal/alerts/notify_darwin.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"state\",\"type\":\"StateStore\",\"constraints\":\"Contains metrics and events indexed by session.id\",\"source\":\"State store\"},{\"name\":\"config\",\"type\":\"AlertConfig\",\"constraints\":\"Thresholds for each rule\",\"source\":\"Config parser\"},{\"name\":\"model_limits\",\"type\":\"map\\u003cstring, int\\u003e\",\"constraints\":\"Model name to context token limit\",\"source\":\"Config parser\"}],\"outputs\":[{\"name\":\"alerts\",\"type\":\"list\\u003cAlert\\u003e\",\"constraints\":\"Each alert has rule name, severity, message, session.id (if applicable)\",\"destination\":\"TUI alerts panel and system notification\"}]}}","acceptance_criteria":"- When $/hr exceeds $2.00 (default), a 'Cost Surge' alert fires with the current rate\n- When $/hr is $1.99, no 'Cost Surge' alert fires\n- When token velocity exceeds 50k tokens/min sustained for 3 minutes, 'Runaway Tokens' fires\n- When the same bash command hash fails 3 times in 5 minutes for a session, 'Loop Detector' fires for that session\n- When 3 normalized-equivalent commands fail (npm test/run test/npx jest), 'Loop Detector' fires\n- When \u003e10 api_error events occur in 1 minute, 'Error Storm' fires\n- When a session is active \u003e2 hours with 0 user_prompt events, 'Stale Session' fires\n- When input_tokens \u003e 80% of model context limit, 'Context Pressure' fires\n- When model is not in context limit map, no alert fires and a one-time warning is logged\n- When \u003e50% of tool_decisions are 'reject' in 5 minutes, 'High Rejection Rate' fires\n- Custom thresholds from config override all defaults\n- When system_notify=true, fired alerts trigger osascript display notification\n- When system_notify=false, no osascript is called but alert still appears in results\n- TestAlertCostSurge_Fires passes\n- TestAlertCostSurge_BelowThreshold passes\n- TestAlertRunawayTokens_Fires passes\n- TestAlertLoopDetector_Fires passes\n- TestAlertLoopDetector_Normalization passes\n- TestAlertErrorStorm_Fires passes\n- TestAlertStaleSession_Fires passes\n- TestAlertContextPressure_Fires passes\n- TestAlertContextPressure_UnknownModel passes\n- TestAlertHighRejection_Fires passes\n- TestAlertEngine_WithStateStore passes\n- TestAlertNotification_OSAScript passes","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":480,"created_at":"2026-02-15T01:46:35Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:27:09Z","closed_at":"2026-02-15T02:27:09Z","close_reason":"Closed"}
{"id":"cc-top-eho.18","title":"Implement burn rate odometer panel with retro-styled digital counter","description":"The burn rate panel displays total cost, $/hour rate, trend arrow, and token velocity as a retro-styled digital counter with color thresholds (green/yellow/red).\n\n## Inputs\n- **burn_rate** (`BurnRate`): From burn rate calculator -- Source: Burn rate calculator\n- **selected_session** (`optional\u003cstring\u003e`): Session filter or nil for global -- Source: TUI state\n\n## Outputs\n- **panel_view** (`string`): Styled text with color-coded counter -- Dest: TUI layout\n\n## Constraints\n- Use Lipgloss for retro-styled digital counter appearance\n- Colors must be configurable via config thresholds\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-tui-burn-rate-odometer\",\"files_scope\":[\"internal/tui/burnrate.go\",\"internal/tui/burnrate_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"burn_rate\",\"type\":\"BurnRate\",\"constraints\":\"From burn rate calculator\",\"source\":\"Burn rate calculator\"},{\"name\":\"selected_session\",\"type\":\"optional\\u003cstring\\u003e\",\"constraints\":\"Session filter or nil for global\",\"source\":\"TUI state\"}],\"outputs\":[{\"name\":\"panel_view\",\"type\":\"string\",\"constraints\":\"Styled text with color-coded counter\",\"destination\":\"TUI layout\"}]}}","acceptance_criteria":"- Total cost displays as dollar amount with 2 decimal places\n- $/hour rate displays with 2 decimal places\n- Up-arrow appears when rate is increasing, down-arrow when decreasing\n- Counter color is green when rate \u003c $0.50/hr (default)\n- Counter color is yellow when rate $0.50-$1.99/hr (default)\n- Counter color is red when rate \u003e= $2.00/hr (default)\n- Token velocity displays as 'X,XXX tokens/min'\n- When a session is selected, shows only that session's data\n- When in global view, shows aggregate data from all sessions","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:36Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:30:31Z","closed_at":"2026-02-15T02:30:31Z","close_reason":"Closed"}
{"id":"cc-top-eho.19","title":"Implement ring buffer for events with configurable capacity and eviction","description":"The event buffer stores up to N events (default 1000) in a ring buffer, evicting the oldest event when full, and supports filtered iteration by session and event type.\n\n## Inputs\n- **event** (`FormattedEvent`): Must have session.id and event type -- Source: Event formatter\n- **capacity** (`int`): capacity \u003e= 1 -- Source: Config (event_buffer_size)\n\n## Outputs\n- **events** (`list\u003cFormattedEvent\u003e`): Ordered newest-first, len \u003c= capacity -- Dest: Event stream panel\n\n## Constraints\n- Thread-safe for concurrent Add and List operations\n- Use ring buffer, not unbounded slice\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-event-buffer\",\"files_scope\":[\"internal/events/buffer.go\",\"internal/events/buffer_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"event\",\"type\":\"FormattedEvent\",\"constraints\":\"Must have session.id and event type\",\"source\":\"Event formatter\"},{\"name\":\"capacity\",\"type\":\"int\",\"constraints\":\"capacity \\u003e= 1\",\"source\":\"Config (event_buffer_size)\"}],\"outputs\":[{\"name\":\"events\",\"type\":\"list\\u003cFormattedEvent\\u003e\",\"constraints\":\"Ordered newest-first, len \\u003c= capacity\",\"destination\":\"Event stream panel\"}]}}","acceptance_criteria":"- Add() on a buffer with capacity 1000 stores events up to 1000\n- When event 1001 is added, the oldest event is evicted and only 1000 remain\n- ListBySession('sess-abc') returns only events for that session\n- ListByType('api_error') returns only api_error events\n- ListAll() returns events in chronological order (newest last)\n- A buffer with capacity=1 holds exactly 1 event after 100 adds\n- TestEventBuffer_Eviction passes","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T01:46:36Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:20:34Z","closed_at":"2026-02-15T02:20:34Z","close_reason":"Closed"}
{"id":"cc-top-eho.2","title":"Implement TOML config parser with defaults and validation","description":"The config package loads ~/.config/cc-top/config.toml, merges with sensible defaults for all settings, and returns validation errors for invalid values.\n\n## Inputs\n- **config_file** (`optional\u003cstring\u003e`): Valid TOML syntax or absent -- Source: ~/.config/cc-top/config.toml\n\n## Outputs\n- **config** (`Config struct`): All fields populated with valid values -- Dest: Return value\n\n## Constraints\n- Use BurntSushi/toml for TOML parsing\n- All config values must have sensible defaults\n- Validate port ranges (1-65535), positive thresholds, positive buffer sizes\n\n## Error Cases\n- **Config file not found**: Use all defaults, no error -\u003e Valid Config with defaults\n- **Invalid TOML syntax**: Return parse error with file path and line number -\u003e Error message\n- **grpc_port = -1**: Return validation error -\u003e 'grpc_port must be between 1 and 65535'\n- **grpc_port = 65536**: Return validation error -\u003e 'grpc_port must be between 1 and 65535'\n- **event_buffer_size = 0**: Return validation error -\u003e 'event_buffer_size must be \u003e= 1'\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-config-parser\",\"files_scope\":[\"internal/config/config.go\",\"internal/config/config_test.go\",\"internal/config/defaults.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"config_file\",\"type\":\"optional\\u003cstring\\u003e\",\"constraints\":\"Valid TOML syntax or absent\",\"source\":\"~/.config/cc-top/config.toml\"}],\"outputs\":[{\"name\":\"config\",\"type\":\"Config struct\",\"constraints\":\"All fields populated with valid values\",\"destination\":\"Return value\"}]}}","acceptance_criteria":"- When no config file exists, Load() returns Config with gRPC port 4317, HTTP port 4318, scan interval 5s, event buffer 1000\n- When config.toml sets grpc_port = 5317, Load() returns Config with gRPC port 5317 and all other fields at defaults\n- When config.toml sets grpc_port = -1, Load() returns a validation error containing 'grpc_port must be between 1 and 65535'\n- When config.toml contains unknown_key = true, Load() returns Config with a warning logged about the unknown key\n- When config.toml sets model context limits under [models], they are available in Config.Models map\n- When config.toml sets alert thresholds, they override defaults in Config.Alerts\n- TestConfigParser_Defaults passes\n- TestConfigParser_CustomPorts passes\n- TestConfigParser_PartialConfig passes\n- TestConfigParser_InvalidValue passes\n- TestConfigParser_UnknownKey passes\n- TestConfigParser_ModelContextLimits passes","status":"closed","priority":0,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:26Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:19:05Z","closed_at":"2026-02-15T02:19:05Z","close_reason":"Closed"}
{"id":"cc-top-eho.20","title":"Implement full-screen stats dashboard with Tab toggle","description":"The stats dashboard fills the full screen when toggled via Tab, displaying all 9 aggregate statistics in a formatted layout, and returns to the main dashboard on another Tab press.\n\n## Inputs\n- **stats** (`DashboardStats`): From stats calculator -- Source: Stats calculator\n- **selected_session** (`optional\u003cstring\u003e`): Session filter or nil for global -- Source: TUI state\n\n## Outputs\n- **full_screen_view** (`string`): Full terminal screen with all 9 stats -- Dest: Terminal\n\n## Constraints\n- Use Lipgloss for formatting\n- Must handle terminal resize\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-tui-stats-dashboard\",\"files_scope\":[\"internal/tui/stats.go\",\"internal/tui/stats_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"stats\",\"type\":\"DashboardStats\",\"constraints\":\"From stats calculator\",\"source\":\"Stats calculator\"},{\"name\":\"selected_session\",\"type\":\"optional\\u003cstring\\u003e\",\"constraints\":\"Session filter or nil for global\",\"source\":\"TUI state\"}],\"outputs\":[{\"name\":\"full_screen_view\",\"type\":\"string\",\"constraints\":\"Full terminal screen with all 9 stats\",\"destination\":\"Terminal\"}]}}","acceptance_criteria":"- Tab press from main dashboard shows full-screen stats view\n- Tab press from stats view returns to main dashboard\n- Stats view displays: lines added/removed, commits, PRs, tool acceptance rate by tool, cache efficiency %, average API latency, model breakdown (cost + tokens by model), top tools ranked by frequency, error rate %\n- When a session is selected, stats show only that session's data\n- When in global view, stats aggregate all sessions\n- Handles terminal resize correctly","status":"closed","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:37Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:30:37Z","closed_at":"2026-02-15T02:30:37Z","close_reason":"Closed"}
{"id":"cc-top-eho.21","title":"Implement TUI startup screen with process table and action keys","description":"The startup screen displays a table of all discovered Claude Code processes with telemetry status and provides [E], [F], and [Enter] action keys for configuration and navigation.\n\n## Inputs\n- **processes** (`list\u003cProcessInfo\u003e`): From process scanner with telemetry classification -- Source: Process scanner + telemetry classifier\n- **settings_merge** (`SettingsMerge`): Merge capability for [E] and [F] actions -- Source: Settings merge package\n\n## Outputs\n- **tui_view** (`Bubble Tea Model`): Renders process table with action hints -- Dest: Terminal\n- **navigation** (`ViewTransition`): Enter transitions to main dashboard -- Dest: TUI router\n\n## Constraints\n- Use Bubble Tea framework for TUI\n- Must handle terminal resize\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-tui-startup-screen\",\"files_scope\":[\"internal/tui/startup.go\",\"internal/tui/startup_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"processes\",\"type\":\"list\\u003cProcessInfo\\u003e\",\"constraints\":\"From process scanner with telemetry classification\",\"source\":\"Process scanner + telemetry classifier\"},{\"name\":\"settings_merge\",\"type\":\"SettingsMerge\",\"constraints\":\"Merge capability for [E] and [F] actions\",\"source\":\"Settings merge package\"}],\"outputs\":[{\"name\":\"tui_view\",\"type\":\"Bubble Tea Model\",\"constraints\":\"Renders process table with action hints\",\"destination\":\"Terminal\"},{\"name\":\"navigation\",\"type\":\"ViewTransition\",\"constraints\":\"Enter transitions to main dashboard\",\"destination\":\"TUI router\"}]}}","acceptance_criteria":"- Startup screen shows a table with columns: PID, Terminal, CWD, Telemetry, OTLP Dest, Status\n- A summary line shows 'N connected, N misconfigured, N no telemetry'\n- Pressing [E] merges OTel env vars into settings.json and shows confirmation message\n- Pressing [F] updates only the endpoint in settings.json when 'Wrong port' sessions exist\n- Pressing Enter transitions to the main dashboard\n- When all sessions are correctly configured, [E] and [F] are greyed out\n- When no processes are found, screen shows 'No Claude Code instances found' with hint to start one\n- Pressing [R] triggers a rescan","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:37Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:30:36Z","closed_at":"2026-02-15T02:30:36Z","close_reason":"Closed"}
{"id":"cc-top-eho.22","title":"Implement session list panel with navigation and selection","description":"The session list panel displays all sessions with full metadata, supports keyboard navigation and selection, and updates all other panels when a session is selected or deselected.\n\n## Inputs\n- **sessions** (`list\u003cSessionData\u003e`): From state store with correlation and classification data -- Source: State store\n- **selected** (`optional\u003cstring\u003e`): session.id or nil for global view -- Source: TUI state\n\n## Outputs\n- **panel_view** (`string`): Formatted session rows -- Dest: TUI layout\n- **selection_event** (`SessionSelectedMsg`): Emitted on Enter/Esc -- Dest: Other TUI panels\n\n## Constraints\n- Long CWD paths must be truncated with ~ substitution and ellipsis\n- Session ID truncated to 8 characters\n- Active time formatted as HH:MM:SS\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-tui-session-list\",\"files_scope\":[\"internal/tui/sessionlist.go\",\"internal/tui/sessionlist_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"sessions\",\"type\":\"list\\u003cSessionData\\u003e\",\"constraints\":\"From state store with correlation and classification data\",\"source\":\"State store\"},{\"name\":\"selected\",\"type\":\"optional\\u003cstring\\u003e\",\"constraints\":\"session.id or nil for global view\",\"source\":\"TUI state\"}],\"outputs\":[{\"name\":\"panel_view\",\"type\":\"string\",\"constraints\":\"Formatted session rows\",\"destination\":\"TUI layout\"},{\"name\":\"selection_event\",\"type\":\"SessionSelectedMsg\",\"constraints\":\"Emitted on Enter/Esc\",\"destination\":\"Other TUI panels\"}]}}","acceptance_criteria":"- Each session row shows PID, truncated session ID (8 chars), terminal, CWD (with ~ substitution and ellipsis), telemetry icon, model, status, cost, tokens, and active time\n- Status shows 'active' when last event was within 30 seconds\n- Status shows 'idle' when last event was 30s-5min ago\n- Status shows 'done' when last event was \u003e5min ago\n- Status shows 'exited' for processes that have exited, with final stats preserved\n- Non-telemetry sessions appear greyed out at the bottom\n- Arrow keys navigate up/down, Enter selects, Esc returns to global view\n- When a session is selected, all other panels filter to that session\n- When Esc is pressed, panels return to aggregate global view\n- CWD paths \u003e30 chars are truncated with ~ home-dir substitution and ellipsis\n- TestSessionStatus_Active passes\n- TestSessionStatus_Idle passes\n- TestSessionStatus_Done passes\n- TestTUIModel_SessionSelection passes","status":"closed","priority":0,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:38Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:30:32Z","closed_at":"2026-02-15T02:30:32Z","close_reason":"Closed"}
{"id":"cc-top-eho.23","title":"Implement alerts panel in bottom bar with system notification integration","description":"The alerts panel displays triggered alerts in a bottom bar with severity icons and supports optional macOS system notifications via osascript.\n\n## Inputs\n- **alerts** (`list\u003cAlert\u003e`): From alert engine -- Source: Alert engine\n- **notify_enabled** (`bool`): From config system_notify -- Source: Config\n\n## Outputs\n- **panel_view** (`string`): Bottom bar with alert messages -- Dest: TUI layout\n\n## Constraints\n- osascript calls must be non-blocking (use goroutine)\n- Do not duplicate notifications for the same alert within 60 seconds\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-tui-alerts-panel\",\"files_scope\":[\"internal/tui/alerts.go\",\"internal/tui/alerts_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"alerts\",\"type\":\"list\\u003cAlert\\u003e\",\"constraints\":\"From alert engine\",\"source\":\"Alert engine\"},{\"name\":\"notify_enabled\",\"type\":\"bool\",\"constraints\":\"From config system_notify\",\"source\":\"Config\"}],\"outputs\":[{\"name\":\"panel_view\",\"type\":\"string\",\"constraints\":\"Bottom bar with alert messages\",\"destination\":\"TUI layout\"}]}}","acceptance_criteria":"- When no alerts are active, the bottom bar shows a status line\n- When a 'Cost Surge' alert fires, it appears in the bottom bar with a warning icon and the rate value\n- Multiple alerts display in a scrollable list if they exceed the bar width\n- Alert messages include the rule name, severity, and relevant values\n- When system_notify=true, osascript display notification is called for each new alert\n- When system_notify=false, no osascript calls occur\n- Alerts for a selected session are highlighted","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T01:46:39Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:30:35Z","closed_at":"2026-02-15T02:30:35Z","close_reason":"Closed"}
{"id":"cc-top-eho.24","title":"Implement event stream panel with filtering and auto-scroll","description":"The event stream panel displays a real-time scrolling feed of formatted events, supports filtering by session, event type, and success/failure, and auto-scrolls to show newest events.\n\n## Inputs\n- **events** (`list\u003cFormattedEvent\u003e`): From event buffer, pre-formatted -- Source: Event buffer\n- **filters** (`EventFilters`): Optional session, type, and success filters -- Source: TUI state\n\n## Outputs\n- **panel_view** (`string`): Filtered, scrollable event list -- Dest: TUI layout\n\n## Constraints\n- Render at configurable refresh rate (default 500ms) to avoid TUI freezes\n- Buffer events between renders\n- Use Bubble Tea viewport for scrolling\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-tui-event-stream\",\"files_scope\":[\"internal/tui/eventstream.go\",\"internal/tui/eventstream_test.go\",\"internal/tui/filter.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"events\",\"type\":\"list\\u003cFormattedEvent\\u003e\",\"constraints\":\"From event buffer, pre-formatted\",\"source\":\"Event buffer\"},{\"name\":\"filters\",\"type\":\"EventFilters\",\"constraints\":\"Optional session, type, and success filters\",\"source\":\"TUI state\"}],\"outputs\":[{\"name\":\"panel_view\",\"type\":\"string\",\"constraints\":\"Filtered, scrollable event list\",\"destination\":\"TUI layout\"}]}}","acceptance_criteria":"- Events render in chronological order with newest at bottom\n- Panel auto-scrolls to newest event on update\n- Pressing 'f' opens a filter menu with session, event type, and success/failure options\n- Applying a filter immediately updates the visible events\n- When a session is selected in the session list, only that session's events show\n- When no events exist, panel shows 'No data received yet'\n- Panel remains responsive with 200 events/second input (renders at 500ms intervals)\n- Scroll up/down with j/k or arrow keys when panel is focused","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:39Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:30:34Z","closed_at":"2026-02-15T02:30:34Z","close_reason":"Closed"}
{"id":"cc-top-eho.25","title":"Implement kill switch with SIGSTOP/SIGKILL/SIGCONT and confirmation dialog","description":"The kill switch (Ctrl+K) sends SIGSTOP to freeze the selected session's process, shows a confirmation dialog, then sends SIGKILL on confirm or SIGCONT on cancel.\n\n## Inputs\n- **selected_session** (`optional\u003cSessionData\u003e`): Must have a PID, or show picker if no selection -- Source: TUI state\n- **user_confirmation** (`bool`): Y to kill, n/Esc to cancel -- Source: TUI keyboard input\n\n## Outputs\n- **signal_sent** (`Signal`): SIGSTOP, then SIGKILL or SIGCONT -- Dest: Target process group\n- **session_update** (`SessionStatus`): Marked 'Exited' on kill -- Dest: State store\n\n## Constraints\n- Send signals to process group (-PID), not just PID\n- Handle ESRCH (no such process) gracefully\n- Must work on macOS (syscall.Kill)\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-kill-switch\",\"files_scope\":[\"internal/tui/killswitch.go\",\"internal/tui/killswitch_test.go\",\"internal/process/signal.go\",\"internal/process/signal_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"selected_session\",\"type\":\"optional\\u003cSessionData\\u003e\",\"constraints\":\"Must have a PID, or show picker if no selection\",\"source\":\"TUI state\"},{\"name\":\"user_confirmation\",\"type\":\"bool\",\"constraints\":\"Y to kill, n/Esc to cancel\",\"source\":\"TUI keyboard input\"}],\"outputs\":[{\"name\":\"signal_sent\",\"type\":\"Signal\",\"constraints\":\"SIGSTOP, then SIGKILL or SIGCONT\",\"destination\":\"Target process group\"},{\"name\":\"session_update\",\"type\":\"SessionStatus\",\"constraints\":\"Marked 'Exited' on kill\",\"destination\":\"State store\"}]}}","acceptance_criteria":"- Ctrl+K on a selected session sends SIGSTOP to the process group\n- Confirmation dialog shows 'Kill session \u003cid\u003e (PID \u003cpid\u003e, \u003ccwd\u003e)? [Y/n]'\n- Y confirms: SIGKILL sent to process group, session marked 'Exited'\n- n or Esc cancels: SIGCONT sent to process group, dialog closes, session resumes\n- When no session is selected (global view), a session picker appears listing all active sessions\n- When the target process has already exited, the 'no such process' error is handled gracefully and session is marked 'Exited'\n- When an already-exited session is selected and Ctrl+K pressed, 'Session already exited' message displays and no signals are sent\n- TestKillSwitch_SIGSTOPAndKill passes\n- TestKillSwitch_Cancel_SIGCONT passes\n- TestKillSwitch_ExitedProcess passes","status":"closed","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:40Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:30:38Z","closed_at":"2026-02-15T02:30:38Z","close_reason":"Closed"}
{"id":"cc-top-eho.3","title":"Implement in-memory state store indexed by session ID","description":"The state store provides thread-safe storage and retrieval of OTLP metrics and events indexed by session.id, with support for session enumeration and aggregate queries.\n\n## Inputs\n- **metric** (`OTLPMetric`): May or may not have session.id attribute -- Source: OTLP receiver\n- **event** (`OTLPEvent`): May or may not have session.id attribute -- Source: OTLP receiver\n\n## Outputs\n- **session_data** (`map\u003cstring, SessionData\u003e`): Thread-safe read/write -- Dest: In-memory, queried by TUI and alert engine\n\n## Constraints\n- Use sync.RWMutex for thread-safe access\n- No persistence  all state is in-memory only\n- Must handle counter resets (negative deltas) by treating previous value as 0\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-state-store\",\"files_scope\":[\"internal/state/store.go\",\"internal/state/store_test.go\",\"internal/state/session.go\",\"internal/state/types.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"metric\",\"type\":\"OTLPMetric\",\"constraints\":\"May or may not have session.id attribute\",\"source\":\"OTLP receiver\"},{\"name\":\"event\",\"type\":\"OTLPEvent\",\"constraints\":\"May or may not have session.id attribute\",\"source\":\"OTLP receiver\"}],\"outputs\":[{\"name\":\"session_data\",\"type\":\"map\\u003cstring, SessionData\\u003e\",\"constraints\":\"Thread-safe read/write\",\"destination\":\"In-memory, queried by TUI and alert engine\"}]}}","acceptance_criteria":"- AddMetric with session.id='sess-001' stores the metric retrievable via GetSession('sess-001')\n- AddEvent with session.id='sess-002' stores the event retrievable via GetSession('sess-002')\n- AddMetric with missing session.id stores under 'unknown' session bucket\n- AddEvent with missing session.id stores under 'unknown' session bucket and logs a warning\n- ListSessions() returns all session IDs including 'unknown' if populated\n- Concurrent AddMetric calls from multiple goroutines do not cause data races (go test -race passes)\n- GetAggregatedCost() returns the sum of cost.usage across all sessions\n- TestStateStore_IndexMetricBySessionID passes\n- TestStateStore_IndexEventBySessionID passes\n- TestStateStore_MissingSessID passes","status":"closed","priority":0,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:27Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:18:19Z","closed_at":"2026-02-15T02:18:19Z","close_reason":"Closed"}
{"id":"cc-top-eho.4","title":"Implement settings.json merge logic for OTel environment variables","description":"The settings package reads ~/.claude/settings.json, merges required OTel environment variables into the 'env' block, preserves all other keys and original indentation, and handles all error conditions.\n\n## Inputs\n- **settings_path** (`string`): Default ~/.claude/settings.json -- Source: Filesystem\n- **interactive** (`bool`): true for TUI, false for --setup CLI -- Source: Caller context\n- **fix_port_only** (`bool`): true when [F] pressed, false for [E] -- Source: Caller context\n\n## Outputs\n- **updated_file** (`JSON file`): Valid JSON preserving original indentation -- Dest: ~/.claude/settings.json\n- **result** (`MergeResult`): Success, AlreadyConfigured, Error, or NeedsConfirmation -- Dest: Return value\n\n## Constraints\n- Use atomic write (write to temp file, then rename) to avoid corruption\n- Detect indentation by examining first indented line of original file\n- Never lose data  backup before any destructive operation\n\n## Error Cases\n- **File does not exist**: Create with OTel env vars -\u003e New file with env block\n- **Malformed JSON**: Create .bak backup, return error -\u003e Error: settings.json contains invalid JSON. Backup saved.\n- **Permission denied**: Return error, no crash -\u003e Error: permission denied writing to ~/.claude/settings.json\n- **Concurrent write by another tool**: Atomic write via temp+rename prevents corruption -\u003e Clean file or error\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-settings-merge\",\"files_scope\":[\"internal/settings/merge.go\",\"internal/settings/merge_test.go\",\"internal/settings/indent.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"settings_path\",\"type\":\"string\",\"constraints\":\"Default ~/.claude/settings.json\",\"source\":\"Filesystem\"},{\"name\":\"interactive\",\"type\":\"bool\",\"constraints\":\"true for TUI, false for --setup CLI\",\"source\":\"Caller context\"},{\"name\":\"fix_port_only\",\"type\":\"bool\",\"constraints\":\"true when [F] pressed, false for [E]\",\"source\":\"Caller context\"}],\"outputs\":[{\"name\":\"updated_file\",\"type\":\"JSON file\",\"constraints\":\"Valid JSON preserving original indentation\",\"destination\":\"~/.claude/settings.json\"},{\"name\":\"result\",\"type\":\"MergeResult\",\"constraints\":\"Success, AlreadyConfigured, Error, or NeedsConfirmation\",\"destination\":\"Return value\"}]}}","acceptance_criteria":"- Given {\"env\": {\"MY_VAR\": \"keep\"}, \"other_key\": true}, Merge adds OTel keys to env block and MY_VAR is still 'keep' and other_key is still true\n- When settings.json does not exist, Merge creates it with the required OTel env vars\n- When all OTel keys are already correct, Merge returns AlreadyConfigured and does not write the file\n- When settings.json contains invalid JSON, Merge creates a .bak backup and returns an error without writing\n- When settings.json is read-only, Merge returns an error containing 'permission denied'\n- When settings.json uses 4-space indentation, the output preserves 4-space indentation\n- When fix_port_only=true, only OTEL_EXPORTER_OTLP_ENDPOINT is updated\n- When interactive=false and an existing value differs, Merge warns but does not overwrite\n- TestSettingsMerge_AddKeys passes\n- TestSettingsMerge_CreateFile passes\n- TestSettingsMerge_PreserveIndent passes\n- TestSettingsMerge_AlreadyConfigured passes\n- TestSettingsMerge_MalformedJSON passes\n- TestSettingsMerge_PermissionDenied passes\n- TestSettingsMerge_DifferentValue_NonInteractive passes\n- TestSettingsMerge_FixWrongPort passes","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:27Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:21:52Z","closed_at":"2026-02-15T02:21:52Z","close_reason":"Closed"}
{"id":"cc-top-eho.5","title":"Implement command normalizer for semantically similar bash commands","description":"The command normalizer groups semantically similar bash commands (e.g., npm test, npm run test, npx jest) into the same group by prefix matching, returning a stable hash for each group.\n\n## Inputs\n- **command** (`string`): Raw bash command from tool_result event -- Source: OTLP event attributes\n\n## Outputs\n- **normalized_hash** (`string`): Stable hash for the command group -- Dest: Alert engine loop detector\n\n## Constraints\n- Use prefix matching for grouping, not exact string comparison\n- Known test-runner families: npm/npx/yarn test variants, pytest variants, go test variants\n- Unknown commands get their own hash (no false grouping)\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-command-normalizer\",\"files_scope\":[\"internal/alerts/normalizer.go\",\"internal/alerts/normalizer_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"command\",\"type\":\"string\",\"constraints\":\"Raw bash command from tool_result event\",\"source\":\"OTLP event attributes\"}],\"outputs\":[{\"name\":\"normalized_hash\",\"type\":\"string\",\"constraints\":\"Stable hash for the command group\",\"destination\":\"Alert engine loop detector\"}]}}","acceptance_criteria":"- Normalize('npm test') and Normalize('npm run test') and Normalize('npx jest') return the same hash\n- Normalize('python -m pytest') and Normalize('pytest') return the same hash\n- Normalize('go test ./...') and Normalize('go test ./pkg/...') return the same hash\n- Normalize('ls -la') returns a unique hash (not grouped with test commands)\n- Normalize('') returns empty string (no hash for empty commands)\n- A 10KB command string is hashed without error\n- TestCommandNormalizer_PrefixMatch passes","status":"closed","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-15T01:46:28Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:17:53Z","closed_at":"2026-02-15T02:17:53Z","close_reason":"Closed"}
{"id":"cc-top-eho.6","title":"Implement main dashboard TUI layout with panel arrangement","description":"The main dashboard arranges the session list, burn rate odometer, event stream, and alerts panels in a responsive layout that handles terminal resize.\n\n## Inputs\n- **terminal_size** (`tuple(int, int)`): Width \u003e= 80, Height \u003e= 24 -- Source: Bubble Tea WindowSizeMsg\n- **active_view** (`ViewState`): Dashboard or Stats -- Source: TUI state\n\n## Outputs\n- **layout** (`Bubble Tea Model`): All panels visible and correctly sized -- Dest: Terminal\n\n## Constraints\n- Use Bubble Tea for TUI framework\n- Use Lipgloss for styling\n- Use Bubbles for reusable components\n- Must re-layout on terminal resize without data loss\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-tui-main-layout\",\"files_scope\":[\"internal/tui/layout.go\",\"internal/tui/layout_test.go\",\"internal/tui/model.go\",\"internal/tui/keys.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"terminal_size\",\"type\":\"tuple(int, int)\",\"constraints\":\"Width \\u003e= 80, Height \\u003e= 24\",\"source\":\"Bubble Tea WindowSizeMsg\"},{\"name\":\"active_view\",\"type\":\"ViewState\",\"constraints\":\"Dashboard or Stats\",\"source\":\"TUI state\"}],\"outputs\":[{\"name\":\"layout\",\"type\":\"Bubble Tea Model\",\"constraints\":\"All panels visible and correctly sized\",\"destination\":\"Terminal\"}]}}","acceptance_criteria":"- At 120x40, all four panels (session list, burn rate, event stream, alerts) are visible\n- At 80x24, panels resize to fit without data loss\n- Tab key toggles between main dashboard and stats dashboard full-screen view\n- q key triggers graceful shutdown\n- All keyboard shortcuts (arrows, Enter, Esc, f, Tab, Ctrl+K) are routed to correct handlers\n- TestTUIModel_TabToggle passes","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:29Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:30:30Z","closed_at":"2026-02-15T02:30:30Z","close_reason":"Closed"}
{"id":"cc-top-eho.7","title":"Implement macOS process scanner for Claude Code detection","description":"The process scanner uses macOS libproc APIs to discover all running Claude Code processes, returning PID, binary name, command-line arguments, CWD, terminal type, and environment variables for each.\n\n## Inputs\n- **scan_interval** (`duration`): Default 5 seconds, configurable -- Source: Config\n\n## Outputs\n- **processes** (`list\u003cProcessInfo\u003e`): Only processes owned by current user -- Dest: State store and correlator\n\n## Constraints\n- Use macOS libproc APIs: proc_listallpids, proc_pidinfo, sysctl KERN_PROCARGS2\n- No root/sudo required  only scan current user's processes\n- Must use //go:build darwin build tag\n- Must not crash on zombie or permission-denied processes\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-process-scanner\",\"files_scope\":[\"internal/scanner/scanner.go\",\"internal/scanner/scanner_test.go\",\"internal/scanner/libproc_darwin.go\",\"internal/scanner/types.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"scan_interval\",\"type\":\"duration\",\"constraints\":\"Default 5 seconds, configurable\",\"source\":\"Config\"}],\"outputs\":[{\"name\":\"processes\",\"type\":\"list\\u003cProcessInfo\\u003e\",\"constraints\":\"Only processes owned by current user\",\"destination\":\"State store and correlator\"}]}}","acceptance_criteria":"- Scan() returns a ProcessInfo for each running process named 'claude' owned by the current user\n- Scan() detects a 'node' process with '@anthropic-ai/claude-code' in its argv as a Claude Code instance\n- A process named 'claude-helper' is NOT detected (no false positives)\n- Each ProcessInfo includes PID, binary name, CWD, terminal type, and raw environment string\n- Zombie processes with unreadable env vars return a ProcessInfo with EnvReadable=false and no crash\n- StartPeriodicScan() calls Scan() every scan_interval and publishes updates\n- When a new PID appears, it is tagged as 'New' for one scan cycle\n- When a previously seen PID disappears, it is tagged as 'Exited' with preserved last-known data\n- Uses //go:build darwin build tag for macOS-specific code\n- TestProcessScanner_DetectClaude passes\n- TestProcessScanner_DetectNodeClaude passes\n- TestProcessScanner_NewProcess passes\n- TestProcessScanner_ExitedProcess passes","status":"closed","priority":0,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":480,"created_at":"2026-02-15T01:46:29Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:22:07Z","closed_at":"2026-02-15T02:22:07Z","close_reason":"Closed"}
{"id":"cc-top-eho.8","title":"Implement OTLP gRPC receiver for metrics ingestion","description":"The gRPC receiver listens on the configured port, accepts ExportMetricsServiceRequest payloads, extracts session.id, and stores metrics in the state store.\n\n## Inputs\n- **otlp_request** (`ExportMetricsServiceRequest (protobuf)`): Valid OTLP v1 protobuf -- Source: gRPC connection on configured port\n- **config** (`Config`): Valid gRPC port -- Source: Config parser\n\n## Outputs\n- **stored_metrics** (`Metrics in state store`): Indexed by session.id -- Dest: State store\n- **grpc_response** (`ExportMetricsServiceResponse`): Standard OTLP response -- Dest: gRPC client\n\n## Constraints\n- Use go.opentelemetry.io/collector/receiver/otlpreceiver or hand-rolled gRPC server with OTLP proto\n- Capture inbound connection source port for PID-to-session correlation\n- Must not crash on malformed input\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-otlp-grpc-receiver\",\"files_scope\":[\"internal/receiver/grpc.go\",\"internal/receiver/grpc_test.go\",\"internal/receiver/server.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"otlp_request\",\"type\":\"ExportMetricsServiceRequest (protobuf)\",\"constraints\":\"Valid OTLP v1 protobuf\",\"source\":\"gRPC connection on configured port\"},{\"name\":\"config\",\"type\":\"Config\",\"constraints\":\"Valid gRPC port\",\"source\":\"Config parser\"}],\"outputs\":[{\"name\":\"stored_metrics\",\"type\":\"Metrics in state store\",\"constraints\":\"Indexed by session.id\",\"destination\":\"State store\"},{\"name\":\"grpc_response\",\"type\":\"ExportMetricsServiceResponse\",\"constraints\":\"Standard OTLP response\",\"destination\":\"gRPC client\"}]}}","acceptance_criteria":"- Receiver binds to configured gRPC port (default 4317) on startup\n- A valid ExportMetricsServiceRequest with session.id='sess-001' and cost.usage metric is stored in the state store under 'sess-001'\n- A malformed protobuf payload returns an OTLP error response and receiver continues accepting new requests\n- When the configured port is already in use, Start() returns an error containing 'port 4317 already in use'\n- The source port of the inbound connection is captured and made available for PID correlation\n- TestOTLPReceiver_GRPCMetrics passes\n- TestOTLPReceiver_MalformedPayload passes\n- TestOTLPReceiver_PortConflict passes","status":"closed","priority":0,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":480,"created_at":"2026-02-15T01:46:30Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:26:59Z","closed_at":"2026-02-15T02:26:59Z","close_reason":"Closed"}
{"id":"cc-top-eho.9","title":"Implement OTLP HTTP receiver for log event ingestion","description":"The HTTP receiver listens on the configured port, accepts OTLP log export requests via HTTP POST, extracts session.id, and stores events in the state store.\n\n## Inputs\n- **otlp_request** (`ExportLogsServiceRequest (protobuf or JSON)`): Valid OTLP v1 payload -- Source: HTTP POST on configured port\n- **config** (`Config`): Valid HTTP port -- Source: Config parser\n\n## Outputs\n- **stored_events** (`Events in state store`): Indexed by session.id -- Dest: State store\n- **http_response** (`HTTP response`): 200 OK or appropriate error code -- Dest: HTTP client\n\n## Constraints\n- Support both protobuf and JSON OTLP encoding\n- Capture inbound connection source port for PID-to-session correlation\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"implement-otlp-http-receiver\",\"files_scope\":[\"internal/receiver/http.go\",\"internal/receiver/http_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"otlp_request\",\"type\":\"ExportLogsServiceRequest (protobuf or JSON)\",\"constraints\":\"Valid OTLP v1 payload\",\"source\":\"HTTP POST on configured port\"},{\"name\":\"config\",\"type\":\"Config\",\"constraints\":\"Valid HTTP port\",\"source\":\"Config parser\"}],\"outputs\":[{\"name\":\"stored_events\",\"type\":\"Events in state store\",\"constraints\":\"Indexed by session.id\",\"destination\":\"State store\"},{\"name\":\"http_response\",\"type\":\"HTTP response\",\"constraints\":\"200 OK or appropriate error code\",\"destination\":\"HTTP client\"}]}}","acceptance_criteria":"- Receiver binds to configured HTTP port (default 4318) on startup\n- A valid OTLP log export POST with session.id='sess-002' stores the event under 'sess-002' in the state store\n- An invalid payload returns HTTP 400 with OTLP error body and receiver continues\n- When the configured port is already in use, Start() returns an error containing the port number\n- TestOTLPReceiver_HTTPEvents passes","status":"closed","priority":0,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-15T01:46:30Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T02:27:02Z","closed_at":"2026-02-15T02:27:02Z","close_reason":"Closed"}
{"id":"cc-top-pyh","title":"Add sustained duration check to runaway tokens rule","description":"alerts/rules.go runawayTokensRule fires immediately when token velocity exceeds threshold. Spec requires velocity to be sustained above threshold for \u003e N minutes before firing. Currently no duration tracking exists and no RunawayTokenSustainedMinutes config field. Fix: add state tracking for how long velocity has been elevated, add config field for sustained duration (suggest default 2 min), only fire after sustained period.","status":"closed","priority":2,"issue_type":"bug","owner":"riabtchuk@gmail.com","created_at":"2026-02-15T04:21:55Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T04:43:26Z","closed_at":"2026-02-15T04:43:26Z","close_reason":"Fixed by parallel agent team"}
{"id":"cc-top-s32","title":"Task Graph: /Users/nixlim/Sync/PROJECTS/foundry_zero/cc-top/.tasks/persist-runtime-data-redesign-history.task.json","status":"closed","priority":0,"issue_type":"epic","owner":"riabtchuk@gmail.com","created_at":"2026-02-21T17:11:44Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:14:06Z","closed_at":"2026-02-21T17:14:06Z","close_reason":"Duplicate created by background process; cc-top-v63 is the authoritative epic","labels":["taskval-managed"]}
{"id":"cc-top-s32.1","title":"Implement schema migration from v1 to v2 with busy_timeout pragma","description":"The database schema migration creates daily_stats, burn_rate_snapshots, and alert_history tables in a single transaction, sets PRAGMA busy_timeout to 5000, and chains v0-\u003ev1-\u003ev2 for fresh installs.\n\n## Inputs\n- **existing_schema** (`SQL DDL`): v0 or v1 schema -- Source: SQLite database file\n- **v2_ddl** (`SQL DDL`): 3 CREATE TABLE + 3 CREATE INDEX statements -- Source: Spec table schemas section\n\n## Outputs\n- **migrated_database** (`SQLite file`): schema_version=2, all tables present, busy_timeout=5000 -- Dest: SQLite database file\n\n## Constraints\n- Migration must run in a single transaction (all-or-nothing)\n- busy_timeout must be set before any migrations or writes\n- Uses modernc.org/sqlite (pure Go, no CGo)\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"schema-migration-v2\",\"files_scope\":[\"internal/storage/schema.go\",\"internal/storage/schema_test.go\",\"internal/storage/store.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"existing_schema\",\"type\":\"SQL DDL\",\"constraints\":\"v0 or v1 schema\",\"source\":\"SQLite database file\"},{\"name\":\"v2_ddl\",\"type\":\"SQL DDL\",\"constraints\":\"3 CREATE TABLE + 3 CREATE INDEX statements\",\"source\":\"Spec table schemas section\"}],\"outputs\":[{\"name\":\"migrated_database\",\"type\":\"SQLite file\",\"constraints\":\"schema_version=2, all tables present, busy_timeout=5000\",\"destination\":\"SQLite database file\"}]}}","acceptance_criteria":"- PRAGMA busy_timeout returns 5000 after OpenDB completes (TestOpenDB_SetsBusyTimeout)\n- Migration from v1 creates daily_stats, burn_rate_snapshots, alert_history tables with all specified columns (TestMigrateV1ToV2_CreatesNewTables)\n- Indexes idx_burnrate_ts, idx_alert_history_fired, idx_alert_history_rule exist after migration (TestMigrateV1ToV2_CreatesIndexes)\n- schema_version table contains 2 after successful migration (TestMigrateV1ToV2_SetsVersionTo2)\n- Pre-existing sessions, metrics, events, daily_summaries data survives migration (TestMigrateV1ToV2_PreservesExistingData)\n- Fresh install (no database) creates all v1 and v2 tables via v0-\u003ev1-\u003ev2 chain (TestFreshInstall_CreatesFullSchema)\n- Database already at v2 triggers no migration SQL (TestMigrateV2ToV2_NoOp)\n- Injected DDL failure mid-migration rolls back transaction leaving schema at v1 with no partial tables (TestMigrateV1ToV2_RollbackOnPartialFailure)\n- go test ./internal/storage/... -run TestMigrate passes with 0 failures","notes":"FR-001, FR-002, FR-003, FR-032. The daily_stats(date) PRIMARY KEY already creates an index so no explicit index is needed for it.","status":"closed","priority":0,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-21T17:11:46Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:14:37Z","closed_at":"2026-02-21T17:14:37Z","close_reason":"Duplicate; see cc-top-v63","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-s32.1","depends_on_id":"cc-top-s32","type":"parent-child","created_at":"2026-02-21T17:11:46Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-s32.10","title":"Implement history sub-tab navigation with 1/2/3/4 keys and granularity switching","description":"Pressing 1/2/3/4 on the History view switches between Overview, Performance, Burn Rate, and Alerts sub-tabs; pressing d/w/m on sub-tabs 1-3 changes granularity; keys are ignored outside the History view.\n\n## Inputs\n- **key_events** (`tea.KeyMsg`): 1-4 for sub-tabs, d/w/m for granularity -- Source: Bubble Tea key dispatch\n- **model_state** (`tui.Model`): historySection (0-3), historyGranularity, historyCursor fields -- Source: TUI model\n\n## Outputs\n- **updated_model** (`tui.Model`): historySection updated, historyCursor reset to 0 on sub-tab switch -- Dest: Bubble Tea Update return\n\n## Constraints\n- Number keys handled only by handleHistoryKey\n- Keys 1-4 must be ignored on Dashboard, Stats, Startup views\n- d/w/m ignored on sub-tab 4 (Alerts)\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"history-subtab-navigation\",\"files_scope\":[\"internal/tui/model.go\",\"internal/tui/keys.go\",\"internal/tui/history.go\",\"internal/tui/history_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"key_events\",\"type\":\"tea.KeyMsg\",\"constraints\":\"1-4 for sub-tabs, d/w/m for granularity\",\"source\":\"Bubble Tea key dispatch\"},{\"name\":\"model_state\",\"type\":\"tui.Model\",\"constraints\":\"historySection (0-3), historyGranularity, historyCursor fields\",\"source\":\"TUI model\"}],\"outputs\":[{\"name\":\"updated_model\",\"type\":\"tui.Model\",\"constraints\":\"historySection updated, historyCursor reset to 0 on sub-tab switch\",\"destination\":\"Bubble Tea Update return\"}]}}","acceptance_criteria":"- Pressing 1/2/3/4 on History view sets historySection to 0/1/2/3 respectively (TestHistorySubTabNavigation)\n- Pressing 1/2/3/4 on Dashboard view causes no state change (TestHistoryNumberKeys_IgnoredOutsideHistory)\n- Setting weekly granularity on tab 2 then switching to tab 3 preserves weekly (TestHistoryGranularity_PersistsAcrossTabs)\n- Pressing w on tab 4 (Alerts) causes no granularity change (TestHistoryGranularity_IgnoredOnAlerts)\n- historyCursor resets to 0 on sub-tab switch and granularity change\n- historySection, historyCursor, and historyGranularity persist across History-\u003eDashboard-\u003eHistory view switches\n- Model struct has historySection int (range 0-3, default 0) and historyCursor int (default 0)\n- go test ./internal/tui/... -run 'TestHistory' passes with 0 failures","notes":"FR-013, FR-014, FR-015. The existing per-view key dispatch pattern in handleKey() already isolates History-only keys.","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-21T17:12:00Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:14:51Z","closed_at":"2026-02-21T17:14:51Z","close_reason":"Duplicate; see cc-top-v63","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-s32.10","depends_on_id":"cc-top-s32","type":"parent-child","created_at":"2026-02-21T17:12:00Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-s32.10","depends_on_id":"cc-top-s32.9","type":"blocks","created_at":"2026-02-21T17:12:25Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-s32.11","title":"Wire all new components together in cmd/cc-top main","description":"The main entry point configures SQLiteStore with stats and burn rate callbacks, passes AlertPersister to the alert engine, passes HistoryProvider to the TUI model, and calls StartBurnRateSnapshots.\n\n## Inputs\n- **sqlite_store** (`storage.SQLiteStore`): Already created in main -- Source: Existing main setup\n- **stats_calc** (`stats.Calculator`): Already created in main -- Source: Existing main setup\n- **burn_calc** (`burnrate.Calculator`): Already created in main -- Source: Existing main setup\n- **alert_engine** (`alerts.Engine`): Already created in main -- Source: Existing main setup\n\n## Outputs\n- **configured_app** (`Running cc-top application`): All persistence, snapshots, and history features active -- Dest: Runtime\n\n## Constraints\n- Must not break existing startup flow\n- Callbacks set after SQLiteStore construction but before StartBurnRateSnapshots\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"main-wiring\",\"files_scope\":[\"cmd/cc-top/main.go\",\"internal/storage/e2e_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"sqlite_store\",\"type\":\"storage.SQLiteStore\",\"constraints\":\"Already created in main\",\"source\":\"Existing main setup\"},{\"name\":\"stats_calc\",\"type\":\"stats.Calculator\",\"constraints\":\"Already created in main\",\"source\":\"Existing main setup\"},{\"name\":\"burn_calc\",\"type\":\"burnrate.Calculator\",\"constraints\":\"Already created in main\",\"source\":\"Existing main setup\"},{\"name\":\"alert_engine\",\"type\":\"alerts.Engine\",\"constraints\":\"Already created in main\",\"source\":\"Existing main setup\"}],\"outputs\":[{\"name\":\"configured_app\",\"type\":\"Running cc-top application\",\"constraints\":\"All persistence, snapshots, and history features active\",\"destination\":\"Runtime\"}]}}","acceptance_criteria":"- SQLiteStore.SetStatsSnapshotFunc is called with a closure wrapping statsCalc.Compute(store.ListSessions())\n- SQLiteStore.SetBurnRateSnapshotFunc is called with a closure wrapping burnCalc.Compute()\n- Alert engine is created with WithPersister(sqliteStore)\n- TUI model is created with WithHistoryProvider(sqliteStore)\n- SQLiteStore.StartBurnRateSnapshots is called after SetBurnRateSnapshotFunc\n- go build ./cmd/cc-top/ succeeds with no errors\n- Full lifecycle test: start, collect telemetry, persist, restart, display history (TestFullLifecycle_PersistAndRecover)","notes":"This is the integration point that ties all the other tasks together. E2E test verifies full lifecycle.","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-21T17:12:02Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:14:52Z","closed_at":"2026-02-21T17:14:52Z","close_reason":"Duplicate; see cc-top-v63","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-s32.11","depends_on_id":"cc-top-s32","type":"parent-child","created_at":"2026-02-21T17:12:01Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-s32.11","depends_on_id":"cc-top-s32.4","type":"blocks","created_at":"2026-02-21T17:12:28Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-s32.11","depends_on_id":"cc-top-s32.5","type":"blocks","created_at":"2026-02-21T17:12:31Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-s32.11","depends_on_id":"cc-top-s32.8","type":"blocks","created_at":"2026-02-21T17:12:27Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-s32.11","depends_on_id":"cc-top-s32.9","type":"blocks","created_at":"2026-02-21T17:12:30Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-s32.12","title":"Implement history tab header with sub-tab indicators and granularity display","description":"The history header displays sub-tab labels [1]-[4] with the active one highlighted, granularity indicators [D]aily/[W]eekly/[M]onthly with active one highlighted (sub-tabs 1-3), or /:Filter (sub-tab 4).\n\n## Inputs\n- **history_section** (`int`): 0-3 -- Source: TUI model historySection\n- **granularity** (`string`): daily, weekly, or monthly -- Source: TUI model historyGranularity\n\n## Outputs\n- **header_string** (`string`): Format: [1] Overview  [2] Performance  [3] Burn Rate  [4] Alerts  |  [D]aily / [W]eekly / [M]onthly  |  Tab:Dashboard  q:Quit -- Dest: TUI View output\n\n## Constraints\n- Consistent with existing TUI styling patterns\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"history-header-rendering\",\"files_scope\":[\"internal/tui/history.go\",\"internal/tui/history_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"history_section\",\"type\":\"int\",\"constraints\":\"0-3\",\"source\":\"TUI model historySection\"},{\"name\":\"granularity\",\"type\":\"string\",\"constraints\":\"daily, weekly, or monthly\",\"source\":\"TUI model historyGranularity\"}],\"outputs\":[{\"name\":\"header_string\",\"type\":\"string\",\"constraints\":\"Format: [1] Overview  [2] Performance  [3] Burn Rate  [4] Alerts  |  [D]aily / [W]eekly / [M]onthly  |  Tab:Dashboard  q:Quit\",\"destination\":\"TUI View output\"}]}}","acceptance_criteria":"- On sub-tabs 1-3, header shows all 4 sub-tab labels with active one visually highlighted and granularity section with active mode highlighted\n- On sub-tab 4, granularity section is replaced with /:Filter\n- Header format matches: [1] Overview  [2] Performance  [3] Burn Rate  [4] Alerts  |  [D]aily / [W]eekly / [M]onthly  |  Tab:Dashboard  q:Quit\n- go test ./internal/tui/... -run TestHistory passes with 0 failures","notes":"FR-016. This is the visual header for the redesigned history view.","status":"closed","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-21T17:12:04Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:14:54Z","closed_at":"2026-02-21T17:14:54Z","close_reason":"Duplicate; see cc-top-v63","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-s32.12","depends_on_id":"cc-top-s32","type":"parent-child","created_at":"2026-02-21T17:12:03Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-s32.12","depends_on_id":"cc-top-s32.10","type":"blocks","created_at":"2026-02-21T17:12:33Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-s32.13","title":"Implement table rendering for all four history sub-tabs","description":"Each history sub-tab renders a table with the correct columns: Overview (9 columns), Performance (9 columns), Burn Rate (6 columns), Alerts (5 columns), with empty-state messages when no data exists and a persistence-disabled message when HistoryProvider is nil.\n\n## Inputs\n- **history_data** (`HistoryProvider query results`): May be empty, may be nil provider -- Source: HistoryProvider methods\n- **granularity** (`string`): daily, weekly, monthly -- Source: TUI model historyGranularity\n\n## Outputs\n- **rendered_table** (`string`): Lipgloss-styled table output -- Dest: TUI View output\n\n## Constraints\n- Timestamps displayed in local timezone\n- Daily_summaries fallback rows show '--' for unavailable columns\n- Default query parameters: daily=7 days, weekly=28 days, monthly=90 days\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"history-subtab-rendering\",\"files_scope\":[\"internal/tui/history.go\",\"internal/tui/history_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"history_data\",\"type\":\"HistoryProvider query results\",\"constraints\":\"May be empty, may be nil provider\",\"source\":\"HistoryProvider methods\"},{\"name\":\"granularity\",\"type\":\"string\",\"constraints\":\"daily, weekly, monthly\",\"source\":\"TUI model historyGranularity\"}],\"outputs\":[{\"name\":\"rendered_table\",\"type\":\"string\",\"constraints\":\"Lipgloss-styled table output\",\"destination\":\"TUI View output\"}]}}","acceptance_criteria":"- Overview sub-tab renders columns: Date, Cost, Tokens, Sessions, API Reqs, Errors, Lines+, Lines-, Commits (TestHistoryOverview_RendersColumns)\n- Performance sub-tab renders columns: Date, Cache%, Err Rate, Avg Lat, P50, P95, P99, Retries, Cache $ (TestHistoryPerformance_RendersColumns)\n- Burn Rate sub-tab renders columns: Date, Avg $/hr, Peak $/hr, Tokens/min, Daily $, Monthly $ (TestHistoryBurnRate_RendersColumns)\n- Alerts sub-tab renders columns: Time, Rule, Severity, Session, Message (TestHistoryAlerts_RendersColumns)\n- Nil HistoryProvider displays 'persistence is disabled' message (TestHistoryNilProvider)\n- Empty data displays sub-tab-specific messages: Overview/Performance show 'No daily statistics yet...', Burn Rate shows 'No burn rate data yet...', Alerts shows 'No alerts recorded yet...' (TestHistoryEmptyState)\n- Overview sub-tab shows '--' for columns unavailable from daily_summaries fallback data\n- Weekly and monthly granularity aggregate: counts summed, rates averaged, peaks maxed\n- go test ./internal/tui/... -run TestHistory passes with 0 failures","notes":"FR-013, FR-026, FR-027, FR-028, FR-031, FR-035, FR-040. This is the largest TUI task, covering 4 distinct table renderings plus aggregation logic.","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":480,"created_at":"2026-02-21T17:12:05Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:14:55Z","closed_at":"2026-02-21T17:14:55Z","close_reason":"Duplicate; see cc-top-v63","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-s32.13","depends_on_id":"cc-top-s32","type":"parent-child","created_at":"2026-02-21T17:12:05Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-s32.13","depends_on_id":"cc-top-s32.12","type":"blocks","created_at":"2026-02-21T17:12:34Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-s32.13","depends_on_id":"cc-top-s32.7","type":"blocks","created_at":"2026-02-21T17:12:36Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-s32.14","title":"Implement detail overlays for history sub-tab rows","description":"Pressing Enter on a highlighted history row opens a full-screen detail overlay with comprehensive data; Esc or Backspace dismisses it with cursor preserved; weekly/monthly aggregate rows show a mini-table of daily rows.\n\n## Inputs\n- **selected_row** (`DailyStatsRow or BurnRateDailySummary or AlertHistoryRow`): May be empty table -- Source: History sub-tab data at historyCursor position\n- **key_event** (`tea.KeyMsg`): Enter to open, Esc or Backspace to close -- Source: Bubble Tea key dispatch\n\n## Outputs\n- **detail_view** (`string`): Full-screen, key-value pairs for scalars, tables for lists -- Dest: TUI View output\n\n## Constraints\n- Backspace must be added to handleDetailOverlayKey\n- Key-value pairs for scalar data, tables for list data (FR-030)\n- Trend column uses TrendDirection.String(): 'up', 'down', 'flat'\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"detail-overlays\",\"files_scope\":[\"internal/tui/history.go\",\"internal/tui/history_test.go\",\"internal/tui/keys.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"selected_row\",\"type\":\"DailyStatsRow or BurnRateDailySummary or AlertHistoryRow\",\"constraints\":\"May be empty table\",\"source\":\"History sub-tab data at historyCursor position\"},{\"name\":\"key_event\",\"type\":\"tea.KeyMsg\",\"constraints\":\"Enter to open, Esc or Backspace to close\",\"source\":\"Bubble Tea key dispatch\"}],\"outputs\":[{\"name\":\"detail_view\",\"type\":\"string\",\"constraints\":\"Full-screen, key-value pairs for scalars, tables for lists\",\"destination\":\"TUI View output\"}]}}","acceptance_criteria":"- Overview detail shows key-value pairs (cache efficiency, error rate, etc.) and tables (model costs, tool usage, error categories, language breakdown, decision sources) (TestHistoryOverview_RenderWithRealData)\n- Performance detail shows: model breakdown table (Model, Cost, Tokens), top tools table (Tool, Count, Avg Duration ms, P95 Duration ms), error categories table (Category, Count), MCP tool usage table (Server:Tool, Count) (TestHistoryPerformance_RenderWithRealData)\n- Burn Rate detail shows intra-day snapshots table (Time HH:MM, Cost, $/hr, Trend, Tokens/min) with Trend as 'up'/'down'/'flat' (TestHistoryBurnRate_RenderWithRealData)\n- Alert detail shows full message, rule name, severity, session ID, fired timestamp (TestHistoryAlerts_RenderWithRealData)\n- Backspace closes detail overlay and restores cursor position (TestBackspace_ClosesDetailOverlay)\n- Esc closes detail overlay and restores cursor position\n- Enter on weekly/monthly aggregate shows mini-table of daily rows for the period\n- Enter on empty table does nothing\n- go test ./internal/tui/... -run 'TestHistory|TestBackspace' passes with 0 failures","notes":"FR-017, FR-018, FR-019, FR-030, FR-038, FR-039. Backspace key added to handleDetailOverlayKey (currently only handles Esc and Enter).","status":"closed","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":480,"created_at":"2026-02-21T17:12:07Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:14:57Z","closed_at":"2026-02-21T17:14:57Z","close_reason":"Duplicate; see cc-top-v63","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-s32.14","depends_on_id":"cc-top-s32","type":"parent-child","created_at":"2026-02-21T17:12:06Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-s32.14","depends_on_id":"cc-top-s32.13","type":"blocks","created_at":"2026-02-21T17:12:38Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-s32.15","title":"Implement alert rule filter menu on Alerts sub-tab","description":"Pressing / on the Alerts sub-tab opens a modal selection menu listing 'All' plus distinct rules from alert_history; selecting a rule filters the timeline; Esc dismisses without changing the filter; / is ignored on sub-tabs 1-3.\n\n## Inputs\n- **distinct_rules** (`list\u003cstring\u003e`): From SELECT DISTINCT rule FROM alert_history -- Source: HistoryProvider query\n- **key_events** (`tea.KeyMsg`): / to open, arrow keys to navigate, Enter to select, Esc to dismiss -- Source: Bubble Tea key dispatch\n\n## Outputs\n- **filtered_alerts** (`list\u003cAlertHistoryRow\u003e`): Filtered by selected rule or all -- Dest: Alerts sub-tab table\n\n## Constraints\n- Follows existing FilterMenuState pattern\n- Menu items from alert_history data, not engine config (FR-042)\n- / key only active on sub-tab 4 (Alerts)\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"alert-filter-menu\",\"files_scope\":[\"internal/tui/history.go\",\"internal/tui/history_test.go\",\"internal/tui/keys.go\",\"internal/tui/filter.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"distinct_rules\",\"type\":\"list\\u003cstring\\u003e\",\"constraints\":\"From SELECT DISTINCT rule FROM alert_history\",\"source\":\"HistoryProvider query\"},{\"name\":\"key_events\",\"type\":\"tea.KeyMsg\",\"constraints\":\"/ to open, arrow keys to navigate, Enter to select, Esc to dismiss\",\"source\":\"Bubble Tea key dispatch\"}],\"outputs\":[{\"name\":\"filtered_alerts\",\"type\":\"list\\u003cAlertHistoryRow\\u003e\",\"constraints\":\"Filtered by selected rule or all\",\"destination\":\"Alerts sub-tab table\"}]}}","acceptance_criteria":"- / on Alerts sub-tab opens modal menu listing 'All' plus distinct rules from alert_history data (TestHistorySlashKey_OpensFilterMenu)\n- / on sub-tabs 1-3 is ignored (TestHistorySlashKey_IgnoredOnNonAlertsTabs)\n- Esc dismisses filter menu without changing current filter\n- Selecting a rule with Enter filters the Alerts timeline to that rule only\n- Selecting 'All' shows all alerts\n- Rules from historical data that are no longer configured still appear in the menu\n- go test ./internal/tui/... -run 'TestHistorySlash' passes with 0 failures","notes":"FR-029, FR-042. Uses existing FilterMenuState pattern. Header shows /:Filter instead of granularity on Alerts sub-tab.","status":"closed","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-21T17:12:08Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:14:59Z","closed_at":"2026-02-21T17:14:59Z","close_reason":"Duplicate; see cc-top-v63","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-s32.15","depends_on_id":"cc-top-s32","type":"parent-child","created_at":"2026-02-21T17:12:08Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-s32.15","depends_on_id":"cc-top-s32.13","type":"blocks","created_at":"2026-02-21T17:12:40Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-s32.2","title":"Implement daily stats snapshot write operations with upsert and NaN sanitization","description":"A dailyStatsRecord writeOp upserts a row into daily_stats by date, converts latency from seconds to milliseconds, sanitizes NaN/Inf to 0.0, and stores NULL for JSON columns on marshal failure.\n\n## Inputs\n- **stats** (`stats.DashboardStats`): May contain NaN/Inf in float fields, nil or unmarshalable JSON slices -- Source: stats.Calculator.Compute()\n- **date** (`string`): YYYY-MM-DD format, non-empty -- Source: UTC wall clock at snapshot time\n\n## Outputs\n- **daily_stats_row** (`SQL row`): Exactly 1 row per date via INSERT OR REPLACE -- Dest: daily_stats table\n\n## Constraints\n- NaN/Inf sanitization occurs in the writer function, not in the stats callback\n- Latency conversion: seconds * 1000 at write, milliseconds / 1000 at read\n- Participates in existing batch transaction via writeOp pattern\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"daily-stats-write-path\",\"files_scope\":[\"internal/storage/writer.go\",\"internal/storage/store.go\",\"internal/storage/store_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"stats\",\"type\":\"stats.DashboardStats\",\"constraints\":\"May contain NaN/Inf in float fields, nil or unmarshalable JSON slices\",\"source\":\"stats.Calculator.Compute()\"},{\"name\":\"date\",\"type\":\"string\",\"constraints\":\"YYYY-MM-DD format, non-empty\",\"source\":\"UTC wall clock at snapshot time\"}],\"outputs\":[{\"name\":\"daily_stats_row\",\"type\":\"SQL row\",\"constraints\":\"Exactly 1 row per date via INSERT OR REPLACE\",\"destination\":\"daily_stats table\"}]}}","acceptance_criteria":"- Write a dailyStatsRow then query it back; all fields match (TestWriteDailyStats_RoundTrip)\n- Writing twice for the same date produces exactly 1 row with the latest values (TestWriteDailyStats_Upsert)\n- model_breakdown, top_tools, error_categories, language_breakdown, decision_sources, mcp_tool_usage round-trip through JSON correctly (TestWriteDailyStats_JSONColumns)\n- When json.Marshal fails for a JSON column, that column is stored as NULL and error is logged (TestWriteDailyStats_JSONMarshalFailure)\n- AvgAPILatency=1.5s stored as avg_api_latency_ms=1500; read back returns 1.5s (TestWriteDailyStats_LatencyConversion)\n- cache_efficiency=NaN and error_rate=Inf are stored as 0.0 (TestWriteDailyStats_NaNInfSanitizedOnWrite)\n- JSON values exceeding 1MB log a warning but are stored as-is\n- go test ./internal/storage/... -run TestWriteDailyStats passes with 0 failures","notes":"FR-004, FR-011, FR-034, FR-036, FR-041. The top_tools JSON column stores a merged struct from TopTools + ToolPerformance (FR-038).","status":"closed","priority":0,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-21T17:11:48Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:14:39Z","closed_at":"2026-02-21T17:14:39Z","close_reason":"Duplicate; see cc-top-v63","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-s32.2","depends_on_id":"cc-top-s32","type":"parent-child","created_at":"2026-02-21T17:11:47Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-s32.2","depends_on_id":"cc-top-s32.1","type":"blocks","created_at":"2026-02-21T17:12:09Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-s32.3","title":"Implement burn rate snapshot write operations with NaN sanitization","description":"A burnRateSnapshotRecord writeOp inserts a row into burn_rate_snapshots with cost, hourly rate, trend, token velocity, projections, and per-model JSON, sanitizing NaN/Inf to 0.0.\n\n## Inputs\n- **burn_rate** (`burnrate.BurnRate`): May contain NaN/Inf in float fields, nil or unmarshalable PerModel slice -- Source: burnrate.Calculator.Compute()\n- **timestamp** (`string`): RFC 3339 UTC -- Source: time.Now().UTC()\n\n## Outputs\n- **burn_rate_snapshot_row** (`SQL row`): New row per snapshot (no upsert) -- Dest: burn_rate_snapshots table\n\n## Constraints\n- NaN/Inf sanitization occurs in the writer function, not in the burn rate callback\n- Participates in existing batch transaction via writeOp pattern\n- Trend stored as integer: 0=Flat, 1=Up, 2=Down\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"burnrate-snapshot-write-path\",\"files_scope\":[\"internal/storage/writer.go\",\"internal/storage/store.go\",\"internal/storage/store_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"burn_rate\",\"type\":\"burnrate.BurnRate\",\"constraints\":\"May contain NaN/Inf in float fields, nil or unmarshalable PerModel slice\",\"source\":\"burnrate.Calculator.Compute()\"},{\"name\":\"timestamp\",\"type\":\"string\",\"constraints\":\"RFC 3339 UTC\",\"source\":\"time.Now().UTC()\"}],\"outputs\":[{\"name\":\"burn_rate_snapshot_row\",\"type\":\"SQL row\",\"constraints\":\"New row per snapshot (no upsert)\",\"destination\":\"burn_rate_snapshots table\"}]}}","acceptance_criteria":"- Write a burnRateSnapshotRow then query it back; all fields match (TestWriteBurnRateSnapshot_RoundTrip)\n- per_model JSON round-trips correctly (TestWriteBurnRateSnapshot_PerModelJSON)\n- When json.Marshal fails for per_model, column is stored as NULL and error is logged (TestWriteBurnRateSnapshot_JSONMarshalFailure)\n- hourly_rate=NaN and daily_projection=Inf are stored as 0.0 (TestWriteBurnRateSnapshot_NaNInfSanitized)\n- go test ./internal/storage/... -run TestWriteBurnRateSnapshot passes with 0 failures","notes":"FR-007, FR-011, FR-036. Burn rate snapshots are insert-only, not upsert.","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-21T17:11:49Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:14:40Z","closed_at":"2026-02-21T17:14:40Z","close_reason":"Duplicate; see cc-top-v63","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-s32.3","depends_on_id":"cc-top-s32","type":"parent-child","created_at":"2026-02-21T17:11:49Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-s32.3","depends_on_id":"cc-top-s32.1","type":"blocks","created_at":"2026-02-21T17:12:11Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-s32.4","title":"Implement alert history write operations and AlertPersister interface","description":"An alertRecord writeOp inserts a row into alert_history, and SQLiteStore implements the AlertPersister interface that the alert engine calls for each deduplicated alert.\n\n## Inputs\n- **alert** (`alerts.Alert`): Non-duplicate, contains rule, severity, message, session_id, timestamp -- Source: Alert engine deduplicated output\n- **persister** (`AlertPersister interface`): Single-method interface: PersistAlert(alert Alert) -- Source: SQLiteStore\n\n## Outputs\n- **alert_history_row** (`SQL row`): New row per alert -- Dest: alert_history table\n\n## Constraints\n- AlertPersister is a single-method interface, not merged into existing interfaces\n- PersistAlert sends writeOp via sendWrite (non-blocking, drops on full channel)\n- Engine option WithPersister(p) injects the persister\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"alert-history-write-path\",\"files_scope\":[\"internal/storage/writer.go\",\"internal/storage/store.go\",\"internal/storage/store_test.go\",\"internal/alerts/engine.go\",\"internal/alerts/engine_test.go\",\"internal/alerts/types.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"alert\",\"type\":\"alerts.Alert\",\"constraints\":\"Non-duplicate, contains rule, severity, message, session_id, timestamp\",\"source\":\"Alert engine deduplicated output\"},{\"name\":\"persister\",\"type\":\"AlertPersister interface\",\"constraints\":\"Single-method interface: PersistAlert(alert Alert)\",\"source\":\"SQLiteStore\"}],\"outputs\":[{\"name\":\"alert_history_row\",\"type\":\"SQL row\",\"constraints\":\"New row per alert\",\"destination\":\"alert_history table\"}]}}","acceptance_criteria":"- Write an alertHistoryRow then query it back; all fields match (TestWriteAlertHistory_RoundTrip)\n- Global alert with empty session_id is stored and retrieved correctly (TestWriteAlertHistory_EmptySessionID)\n- Alert engine with mock persister calls PersistAlert on deduplicated alert (TestAlertEngine_CallsPersister)\n- Alert engine with nil persister processes alerts normally without panic (TestAlertEngine_NilPersister)\n- When write channel is full, persistence is dropped and droppedWrites counter increments (TestAlertEngine_CallsPersister)\n- go test ./internal/storage/... -run TestWriteAlertHistory passes with 0 failures\n- go test ./internal/alerts/... -run TestAlertEngine passes with 0 failures","notes":"FR-010. The AlertPersister interface is defined in alerts/types.go. SQLiteStore implements it in storage/store.go.","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-21T17:11:51Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:14:42Z","closed_at":"2026-02-21T17:14:42Z","close_reason":"Duplicate; see cc-top-v63","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-s32.4","depends_on_id":"cc-top-s32","type":"parent-child","created_at":"2026-02-21T17:11:50Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-s32.4","depends_on_id":"cc-top-s32.1","type":"blocks","created_at":"2026-02-21T17:12:12Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-s32.5","title":"Add retention pruning for daily_stats, burn_rate_snapshots, and alert_history","description":"The hourly maintenance cycle prunes burn_rate_snapshots older than retention_days (default 7), and daily_stats and alert_history older than summary_retention_days (default 90), using strict less-than comparison.\n\n## Inputs\n- **retention_days** (`int`): Default 7, from config -- Source: Config retention_days\n- **summary_retention_days** (`int`): Default 90, from config -- Source: Config summary_retention_days\n\n## Outputs\n- **pruned_rows** (`int`): Count of deleted rows -- Dest: Log output\n\n## Constraints\n- Uses timestamp \u003c datetime('now', '-N days') for strict less-than\n- Pruning runs during existing hourly maintenance cycle\n- Must not affect existing pruning of sessions, metrics, events, daily_summaries\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"retention-pruning-new-tables\",\"files_scope\":[\"internal/storage/maintenance.go\",\"internal/storage/maintenance_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"retention_days\",\"type\":\"int\",\"constraints\":\"Default 7, from config\",\"source\":\"Config retention_days\"},{\"name\":\"summary_retention_days\",\"type\":\"int\",\"constraints\":\"Default 90, from config\",\"source\":\"Config summary_retention_days\"}],\"outputs\":[{\"name\":\"pruned_rows\",\"type\":\"int\",\"constraints\":\"Count of deleted rows\",\"destination\":\"Log output\"}]}}","acceptance_criteria":"- burn_rate_snapshots rows older than retention_days are deleted by maintenance cycle (TestRetentionPruning_AllNewTables)\n- daily_stats rows older than summary_retention_days are deleted by maintenance cycle (TestRetentionPruning_AllNewTables)\n- alert_history rows older than summary_retention_days are deleted by maintenance cycle (TestRetentionPruning_AllNewTables)\n- Rows exactly at the retention boundary are NOT deleted (strict less-than comparison, FR-037)\n- All rows within retention period are preserved (TestRetentionPruning_AllNewTables)\n- Existing aggregation and pruning behavior for other tables is unaffected (TestMaintenanceCycle_PreservesExistingBehavior)\n- go test ./internal/storage/... -run TestRetention passes with 0 failures","notes":"FR-020, FR-021, FR-022, FR-037. Without pruning, burn rate snapshots accumulate ~288 rows/day.","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-21T17:11:52Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:14:43Z","closed_at":"2026-02-21T17:14:43Z","close_reason":"Duplicate; see cc-top-v63","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-s32.5","depends_on_id":"cc-top-s32","type":"parent-child","created_at":"2026-02-21T17:11:52Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-s32.5","depends_on_id":"cc-top-s32.1","type":"blocks","created_at":"2026-02-21T17:12:14Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-s32.6","title":"Integrate stats and burn rate snapshot callbacks into SQLiteStore","description":"SQLiteStore exposes SetStatsSnapshotFunc and SetBurnRateSnapshotFunc methods, the maintenance cycle calls the stats callback to upsert daily_stats, and StartBurnRateSnapshots runs a 5-minute ticker that calls the burn rate callback.\n\n## Inputs\n- **stats_callback** (`func() stats.DashboardStats`): May be nil -- Source: Main setup via statsCalc.Compute(store.ListSessions())\n- **burnrate_callback** (`func() burnrate.BurnRate`): May be nil -- Source: Main setup via burnCalc.Compute()\n\n## Outputs\n- **daily_stats_rows** (`SQL rows`): 1 row per date per maintenance cycle -- Dest: daily_stats table\n- **burn_rate_snapshot_rows** (`SQL rows`): 1 row per 5-minute interval -- Dest: burn_rate_snapshots table\n\n## Constraints\n- Callbacks set after construction (not at NewSQLiteStore time)\n- Burn rate ticker must not start before SetBurnRateSnapshotFunc is called\n- Stats callback called during hourly maintenance cycle\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"stats-burnrate-callback-integration\",\"files_scope\":[\"internal/storage/store.go\",\"internal/storage/maintenance.go\",\"internal/storage/maintenance_test.go\",\"internal/storage/store_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"stats_callback\",\"type\":\"func() stats.DashboardStats\",\"constraints\":\"May be nil\",\"source\":\"Main setup via statsCalc.Compute(store.ListSessions())\"},{\"name\":\"burnrate_callback\",\"type\":\"func() burnrate.BurnRate\",\"constraints\":\"May be nil\",\"source\":\"Main setup via burnCalc.Compute()\"}],\"outputs\":[{\"name\":\"daily_stats_rows\",\"type\":\"SQL rows\",\"constraints\":\"1 row per date per maintenance cycle\",\"destination\":\"daily_stats table\"},{\"name\":\"burn_rate_snapshot_rows\",\"type\":\"SQL rows\",\"constraints\":\"1 row per 5-minute interval\",\"destination\":\"burn_rate_snapshots table\"}]}}","acceptance_criteria":"- Nil statsSnapshotFn causes maintenance cycle to silently skip stats capture with no error (TestNilStatsCallback_Skipped)\n- Nil burnSnapshotFn causes StartBurnRateSnapshots to return without starting a ticker (TestNilBurnRateCallback_Skipped)\n- Real stats callback during maintenance cycle produces a daily_stats row (TestStatsSnapshotViaMaintenance)\n- Real burn rate callback with ticker produces burn_rate_snapshots rows (TestBurnRateSnapshotViaTicker)\n- go test ./internal/storage/... -run 'TestNilStats|TestNilBurn|TestStatsSnapshot|TestBurnRateSnapshot' passes with 0 failures","notes":"FR-005, FR-007, FR-009. The callbacks are safe for concurrent access (Compute is pure/mutex-protected, ListSessions returns deep copies).","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-21T17:11:54Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:14:45Z","closed_at":"2026-02-21T17:14:45Z","close_reason":"Duplicate; see cc-top-v63","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-s32.6","depends_on_id":"cc-top-s32","type":"parent-child","created_at":"2026-02-21T17:11:54Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-s32.6","depends_on_id":"cc-top-s32.2","type":"blocks","created_at":"2026-02-21T17:12:15Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-s32.6","depends_on_id":"cc-top-s32.3","type":"blocks","created_at":"2026-02-21T17:12:17Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-s32.7","title":"Implement query methods for daily_stats, burn_rate_snapshots, and alert_history","description":"SQLiteStore provides QueryDailyStats (merging daily_stats and daily_summaries), QueryBurnRateDailySummary, QueryBurnRateSnapshots, and QueryAlertHistory methods with correct caps, aggregation, and JSON deserialization.\n\n## Inputs\n- **days** (`int`): Positive integer -- Source: TUI granularity default: daily=7, weekly=28, monthly=90\n- **rule_filter** (`string`): Empty string for no filter, or exact rule name -- Source: Alert filter menu selection\n- **date** (`string`): YYYY-MM-DD format -- Source: Detail overlay drill-down\n\n## Outputs\n- **daily_stats_results** (`list\u003cDailyStatsRow\u003e`): Unified result from daily_stats + daily_summaries, newest first -- Dest: HistoryProvider consumer\n- **burn_rate_daily_summary** (`list\u003cBurnRateDailySummary\u003e`): Aggregated per day: avg/peak rates -- Dest: HistoryProvider consumer\n- **burn_rate_snapshots** (`list\u003cBurnRateSnapshotRow\u003e`): Max 500 rows, newest first -- Dest: HistoryProvider consumer\n- **alert_history** (`list\u003cAlertHistoryRow\u003e`): Max 200 rows, newest first -- Dest: HistoryProvider consumer\n\n## Constraints\n- Burn rate snapshot cap: 500 rows\n- Alert history cap: 200 rows\n- QueryDailyStats internally merges daily_stats and daily_summaries; TUI does not call both\n- Latency conversion on read: milliseconds / 1000 = seconds\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"query-methods-new-tables\",\"files_scope\":[\"internal/storage/query.go\",\"internal/storage/query_test.go\",\"internal/storage/store.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"days\",\"type\":\"int\",\"constraints\":\"Positive integer\",\"source\":\"TUI granularity default: daily=7, weekly=28, monthly=90\"},{\"name\":\"rule_filter\",\"type\":\"string\",\"constraints\":\"Empty string for no filter, or exact rule name\",\"source\":\"Alert filter menu selection\"},{\"name\":\"date\",\"type\":\"string\",\"constraints\":\"YYYY-MM-DD format\",\"source\":\"Detail overlay drill-down\"}],\"outputs\":[{\"name\":\"daily_stats_results\",\"type\":\"list\\u003cDailyStatsRow\\u003e\",\"constraints\":\"Unified result from daily_stats + daily_summaries, newest first\",\"destination\":\"HistoryProvider consumer\"},{\"name\":\"burn_rate_daily_summary\",\"type\":\"list\\u003cBurnRateDailySummary\\u003e\",\"constraints\":\"Aggregated per day: avg/peak rates\",\"destination\":\"HistoryProvider consumer\"},{\"name\":\"burn_rate_snapshots\",\"type\":\"list\\u003cBurnRateSnapshotRow\\u003e\",\"constraints\":\"Max 500 rows, newest first\",\"destination\":\"HistoryProvider consumer\"},{\"name\":\"alert_history\",\"type\":\"list\\u003cAlertHistoryRow\\u003e\",\"constraints\":\"Max 200 rows, newest first\",\"destination\":\"HistoryProvider consumer\"}]}}","acceptance_criteria":"- Insert 10 days of daily_stats, query 7 days, get correct 7 most recent rows (TestQueryDailyStats_ReturnsCorrectDays)\n- Invalid JSON in a daily_stats column returns zero value for that field and logs error (TestQueryDailyStats_JSONUnmarshalFailure)\n- Insert 600 burn rate snapshots, query returns 500 most recent (TestQueryBurnRateSnapshots_WithLimit)\n- Multiple snapshots per day aggregate to correct avg/peak in daily summary (TestQueryBurnRateDailySummary_Aggregation)\n- Alert query with rule filter returns only matching alerts (TestQueryAlertHistory_WithRuleFilter)\n- Insert 300 alerts, query returns 200 most recent (TestQueryAlertHistory_WithLimit)\n- Alert query with empty filter returns all alerts up to 200 (TestQueryAlertHistory_NoFilter)\n- QueryDailyStats merges daily_stats and daily_summaries: daily_stats rows show all columns, daily_summaries rows show available columns with unavailable columns marked (TestHistoryOverview_MergesLegacyAndNewData)\n- Latency values read back as seconds (divided by 1000 from stored milliseconds)\n- go test ./internal/storage/... -run 'TestQuery' passes with 0 failures","notes":"FR-012, FR-023, FR-024, FR-034, FR-035. The merge logic for Overview is presence-based: daily_stats row takes priority; daily_summaries is fallback.","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":480,"created_at":"2026-02-21T17:11:56Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:14:46Z","closed_at":"2026-02-21T17:14:46Z","close_reason":"Duplicate; see cc-top-v63","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-s32.7","depends_on_id":"cc-top-s32","type":"parent-child","created_at":"2026-02-21T17:11:55Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-s32.7","depends_on_id":"cc-top-s32.2","type":"blocks","created_at":"2026-02-21T17:12:18Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-s32.7","depends_on_id":"cc-top-s32.3","type":"blocks","created_at":"2026-02-21T17:12:20Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-s32.7","depends_on_id":"cc-top-s32.4","type":"blocks","created_at":"2026-02-21T17:12:21Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-s32.8","title":"Reorder shutdown sequence to capture final snapshots before closing","description":"The Close() method follows the exact sequence: stop burn rate ticker (5s timeout), capture final burn rate snapshot via sendFinalWrite, capture final stats snapshot via sendFinalWrite, set closed=true, cancel maintenance (30s timeout), close write channel, drain writer (10s timeout), run daily aggregation, close database.\n\n## Inputs\n- **callbacks** (`func() stats.DashboardStats and func() burnrate.BurnRate`): May be nil or may hang -- Source: Previously set via Set*SnapshotFunc\n- **write_channel** (`chan writeOp`): Capacity 1000, may be full -- Source: SQLiteStore internal\n\n## Outputs\n- **final_snapshots** (`SQL rows`): 1 daily_stats row + 1 burn_rate_snapshot row if callbacks set and not hung -- Dest: SQLite database\n\n## Constraints\n- sendFinalWrite MUST NOT check the closed flag\n- sendFinalWrite MUST use blocking send with 1-second timeout (not select/default drop pattern)\n- Exact ordering per FR-033 is mandatory\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"shutdown-sequence-reorder\",\"files_scope\":[\"internal/storage/store.go\",\"internal/storage/shutdown_test.go\",\"internal/storage/store_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"callbacks\",\"type\":\"func() stats.DashboardStats and func() burnrate.BurnRate\",\"constraints\":\"May be nil or may hang\",\"source\":\"Previously set via Set*SnapshotFunc\"},{\"name\":\"write_channel\",\"type\":\"chan writeOp\",\"constraints\":\"Capacity 1000, may be full\",\"source\":\"SQLiteStore internal\"}],\"outputs\":[{\"name\":\"final_snapshots\",\"type\":\"SQL rows\",\"constraints\":\"1 daily_stats row + 1 burn_rate_snapshot row if callbacks set and not hung\",\"destination\":\"SQLite database\"}]}}","acceptance_criteria":"- Close() with both callbacks set produces final snapshots in both tables (TestShutdownCapturesFinalSnapshots)\n- Shutdown sequence: burn rate ticker stopped, both snapshots enqueued before closed=true, no writes rejected due to closed flag (TestShutdownSequence_FinalSnapshotsBeforeClose)\n- sendFinalWrite with full write channel blocks for up to 1 second then drops with counter increment (TestShutdownFinalWrite_ChannelAtCapacity)\n- Hung burn rate callback times out after 5 seconds and shutdown continues with stats snapshot still captured\n- Session shorter than 5 minutes produces at least one burn rate snapshot from shutdown capture\n- go test ./internal/storage/... -run 'TestShutdown' passes with 0 failures","notes":"FR-006, FR-008, FR-033. This modifies the existing Close() method. Regression test must verify existing behavior (maintenance cancel, writer drain) still works.","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-21T17:11:57Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:14:48Z","closed_at":"2026-02-21T17:14:48Z","close_reason":"Duplicate; see cc-top-v63","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-s32.8","depends_on_id":"cc-top-s32","type":"parent-child","created_at":"2026-02-21T17:11:57Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-s32.8","depends_on_id":"cc-top-s32.6","type":"blocks","created_at":"2026-02-21T17:12:23Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-s32.9","title":"Define HistoryProvider interface and implement adapter in SQLiteStore","description":"A HistoryProvider interface with 4 query methods exists, SQLiteStore implements it, and the TUI model accepts it via WithHistoryProvider option.\n\n## Inputs\n- **query_methods** (`Go methods`): QueryDailyStats, QueryBurnRateDailySummary, QueryBurnRateSnapshots, QueryAlertHistory -- Source: query-methods-new-tables task output\n\n## Outputs\n- **history_provider_interface** (`Go interface`): Separate from StateProvider, 4 methods -- Dest: internal/tui/ package\n- **with_history_provider_option** (`Go functional option`): WithHistoryProvider(p HistoryProvider) -- Dest: TUI model constructor\n\n## Constraints\n- HistoryProvider is a separate interface, not merged into StateProvider\n- Maintains separation of concerns with other 7 provider interfaces\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"history-provider-interface\",\"files_scope\":[\"internal/tui/model.go\",\"internal/tui/history.go\",\"internal/storage/store.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"query_methods\",\"type\":\"Go methods\",\"constraints\":\"QueryDailyStats, QueryBurnRateDailySummary, QueryBurnRateSnapshots, QueryAlertHistory\",\"source\":\"query-methods-new-tables task output\"}],\"outputs\":[{\"name\":\"history_provider_interface\",\"type\":\"Go interface\",\"constraints\":\"Separate from StateProvider, 4 methods\",\"destination\":\"internal/tui/ package\"},{\"name\":\"with_history_provider_option\",\"type\":\"Go functional option\",\"constraints\":\"WithHistoryProvider(p HistoryProvider)\",\"destination\":\"TUI model constructor\"}]}}","acceptance_criteria":"- HistoryProvider interface is defined with QueryDailyStats, QueryBurnRateDailySummary, QueryBurnRateSnapshots, QueryAlertHistory methods\n- SQLiteStore satisfies the HistoryProvider interface (compile-time check)\n- WithHistoryProvider option sets the provider on the TUI model\n- Nil HistoryProvider is accepted without panic\n- go build ./... succeeds with no errors","notes":"FR-013 setup. This is the interface plumbing between storage and TUI layers.","status":"closed","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-21T17:11:59Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:14:49Z","closed_at":"2026-02-21T17:14:49Z","close_reason":"Duplicate; see cc-top-v63","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-s32.9","depends_on_id":"cc-top-s32","type":"parent-child","created_at":"2026-02-21T17:11:58Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-s32.9","depends_on_id":"cc-top-s32.7","type":"blocks","created_at":"2026-02-21T17:12:24Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-v63","title":"Task Graph: /Users/nixlim/Sync/PROJECTS/foundry_zero/cc-top/.tasks/persist-runtime-data-redesign-history.task.json","status":"open","priority":0,"issue_type":"epic","owner":"riabtchuk@gmail.com","created_at":"2026-02-21T17:12:36Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:12:36Z","labels":["taskval-managed"]}
{"id":"cc-top-v63.1","title":"Implement schema migration from v1 to v2 with busy_timeout pragma","description":"The database schema migration creates daily_stats, burn_rate_snapshots, and alert_history tables in a single transaction, sets PRAGMA busy_timeout to 5000, and chains v0-\u003ev1-\u003ev2 for fresh installs.\n\n## Inputs\n- **existing_schema** (`SQL DDL`): v0 or v1 schema -- Source: SQLite database file\n- **v2_ddl** (`SQL DDL`): 3 CREATE TABLE + 3 CREATE INDEX statements -- Source: Spec table schemas section\n\n## Outputs\n- **migrated_database** (`SQLite file`): schema_version=2, all tables present, busy_timeout=5000 -- Dest: SQLite database file\n\n## Constraints\n- Migration must run in a single transaction (all-or-nothing)\n- busy_timeout must be set before any migrations or writes\n- Uses modernc.org/sqlite (pure Go, no CGo)\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"schema-migration-v2\",\"files_scope\":[\"internal/storage/schema.go\",\"internal/storage/schema_test.go\",\"internal/storage/store.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"existing_schema\",\"type\":\"SQL DDL\",\"constraints\":\"v0 or v1 schema\",\"source\":\"SQLite database file\"},{\"name\":\"v2_ddl\",\"type\":\"SQL DDL\",\"constraints\":\"3 CREATE TABLE + 3 CREATE INDEX statements\",\"source\":\"Spec table schemas section\"}],\"outputs\":[{\"name\":\"migrated_database\",\"type\":\"SQLite file\",\"constraints\":\"schema_version=2, all tables present, busy_timeout=5000\",\"destination\":\"SQLite database file\"}]}}","acceptance_criteria":"- PRAGMA busy_timeout returns 5000 after OpenDB completes (TestOpenDB_SetsBusyTimeout)\n- Migration from v1 creates daily_stats, burn_rate_snapshots, alert_history tables with all specified columns (TestMigrateV1ToV2_CreatesNewTables)\n- Indexes idx_burnrate_ts, idx_alert_history_fired, idx_alert_history_rule exist after migration (TestMigrateV1ToV2_CreatesIndexes)\n- schema_version table contains 2 after successful migration (TestMigrateV1ToV2_SetsVersionTo2)\n- Pre-existing sessions, metrics, events, daily_summaries data survives migration (TestMigrateV1ToV2_PreservesExistingData)\n- Fresh install (no database) creates all v1 and v2 tables via v0-\u003ev1-\u003ev2 chain (TestFreshInstall_CreatesFullSchema)\n- Database already at v2 triggers no migration SQL (TestMigrateV2ToV2_NoOp)\n- Injected DDL failure mid-migration rolls back transaction leaving schema at v1 with no partial tables (TestMigrateV1ToV2_RollbackOnPartialFailure)\n- go test ./internal/storage/... -run TestMigrate passes with 0 failures","notes":"FR-001, FR-002, FR-003, FR-032. The daily_stats(date) PRIMARY KEY already creates an index so no explicit index is needed for it.","status":"open","priority":0,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-21T17:12:38Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:13:38Z","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-v63.1","depends_on_id":"cc-top-v63","type":"parent-child","created_at":"2026-02-21T17:12:37Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-v63.10","title":"Implement history sub-tab navigation with 1/2/3/4 keys and granularity switching","description":"Pressing 1/2/3/4 on the History view switches between Overview, Performance, Burn Rate, and Alerts sub-tabs; pressing d/w/m on sub-tabs 1-3 changes granularity; keys are ignored outside the History view.\n\n## Inputs\n- **key_events** (`tea.KeyMsg`): 1-4 for sub-tabs, d/w/m for granularity -- Source: Bubble Tea key dispatch\n- **model_state** (`tui.Model`): historySection (0-3), historyGranularity, historyCursor fields -- Source: TUI model\n\n## Outputs\n- **updated_model** (`tui.Model`): historySection updated, historyCursor reset to 0 on sub-tab switch -- Dest: Bubble Tea Update return\n\n## Constraints\n- Number keys handled only by handleHistoryKey\n- Keys 1-4 must be ignored on Dashboard, Stats, Startup views\n- d/w/m ignored on sub-tab 4 (Alerts)\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"history-subtab-navigation\",\"files_scope\":[\"internal/tui/model.go\",\"internal/tui/keys.go\",\"internal/tui/history.go\",\"internal/tui/history_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"key_events\",\"type\":\"tea.KeyMsg\",\"constraints\":\"1-4 for sub-tabs, d/w/m for granularity\",\"source\":\"Bubble Tea key dispatch\"},{\"name\":\"model_state\",\"type\":\"tui.Model\",\"constraints\":\"historySection (0-3), historyGranularity, historyCursor fields\",\"source\":\"TUI model\"}],\"outputs\":[{\"name\":\"updated_model\",\"type\":\"tui.Model\",\"constraints\":\"historySection updated, historyCursor reset to 0 on sub-tab switch\",\"destination\":\"Bubble Tea Update return\"}]}}","acceptance_criteria":"- Pressing 1/2/3/4 on History view sets historySection to 0/1/2/3 respectively (TestHistorySubTabNavigation)\n- Pressing 1/2/3/4 on Dashboard view causes no state change (TestHistoryNumberKeys_IgnoredOutsideHistory)\n- Setting weekly granularity on tab 2 then switching to tab 3 preserves weekly (TestHistoryGranularity_PersistsAcrossTabs)\n- Pressing w on tab 4 (Alerts) causes no granularity change (TestHistoryGranularity_IgnoredOnAlerts)\n- historyCursor resets to 0 on sub-tab switch and granularity change\n- historySection, historyCursor, and historyGranularity persist across History-\u003eDashboard-\u003eHistory view switches\n- Model struct has historySection int (range 0-3, default 0) and historyCursor int (default 0)\n- go test ./internal/tui/... -run 'TestHistory' passes with 0 failures","notes":"FR-013, FR-014, FR-015. The existing per-view key dispatch pattern in handleKey() already isolates History-only keys.","status":"open","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-21T17:12:55Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:13:51Z","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-v63.10","depends_on_id":"cc-top-v63","type":"parent-child","created_at":"2026-02-21T17:12:54Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-v63.10","depends_on_id":"cc-top-v63.9","type":"blocks","created_at":"2026-02-21T17:13:22Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-v63.11","title":"Wire all new components together in cmd/cc-top main","description":"The main entry point configures SQLiteStore with stats and burn rate callbacks, passes AlertPersister to the alert engine, passes HistoryProvider to the TUI model, and calls StartBurnRateSnapshots.\n\n## Inputs\n- **sqlite_store** (`storage.SQLiteStore`): Already created in main -- Source: Existing main setup\n- **stats_calc** (`stats.Calculator`): Already created in main -- Source: Existing main setup\n- **burn_calc** (`burnrate.Calculator`): Already created in main -- Source: Existing main setup\n- **alert_engine** (`alerts.Engine`): Already created in main -- Source: Existing main setup\n\n## Outputs\n- **configured_app** (`Running cc-top application`): All persistence, snapshots, and history features active -- Dest: Runtime\n\n## Constraints\n- Must not break existing startup flow\n- Callbacks set after SQLiteStore construction but before StartBurnRateSnapshots\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"main-wiring\",\"files_scope\":[\"cmd/cc-top/main.go\",\"internal/storage/e2e_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"sqlite_store\",\"type\":\"storage.SQLiteStore\",\"constraints\":\"Already created in main\",\"source\":\"Existing main setup\"},{\"name\":\"stats_calc\",\"type\":\"stats.Calculator\",\"constraints\":\"Already created in main\",\"source\":\"Existing main setup\"},{\"name\":\"burn_calc\",\"type\":\"burnrate.Calculator\",\"constraints\":\"Already created in main\",\"source\":\"Existing main setup\"},{\"name\":\"alert_engine\",\"type\":\"alerts.Engine\",\"constraints\":\"Already created in main\",\"source\":\"Existing main setup\"}],\"outputs\":[{\"name\":\"configured_app\",\"type\":\"Running cc-top application\",\"constraints\":\"All persistence, snapshots, and history features active\",\"destination\":\"Runtime\"}]}}","acceptance_criteria":"- SQLiteStore.SetStatsSnapshotFunc is called with a closure wrapping statsCalc.Compute(store.ListSessions())\n- SQLiteStore.SetBurnRateSnapshotFunc is called with a closure wrapping burnCalc.Compute()\n- Alert engine is created with WithPersister(sqliteStore)\n- TUI model is created with WithHistoryProvider(sqliteStore)\n- SQLiteStore.StartBurnRateSnapshots is called after SetBurnRateSnapshotFunc\n- go build ./cmd/cc-top/ succeeds with no errors\n- Full lifecycle test: start, collect telemetry, persist, restart, display history (TestFullLifecycle_PersistAndRecover)","notes":"This is the integration point that ties all the other tasks together. E2E test verifies full lifecycle.","status":"open","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-21T17:12:57Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:13:53Z","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-v63.11","depends_on_id":"cc-top-v63","type":"parent-child","created_at":"2026-02-21T17:12:56Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-v63.11","depends_on_id":"cc-top-v63.4","type":"blocks","created_at":"2026-02-21T17:13:25Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-v63.11","depends_on_id":"cc-top-v63.5","type":"blocks","created_at":"2026-02-21T17:13:28Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-v63.11","depends_on_id":"cc-top-v63.8","type":"blocks","created_at":"2026-02-21T17:13:24Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-v63.11","depends_on_id":"cc-top-v63.9","type":"blocks","created_at":"2026-02-21T17:13:27Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-v63.12","title":"Implement history tab header with sub-tab indicators and granularity display","description":"The history header displays sub-tab labels [1]-[4] with the active one highlighted, granularity indicators [D]aily/[W]eekly/[M]onthly with active one highlighted (sub-tabs 1-3), or /:Filter (sub-tab 4).\n\n## Inputs\n- **history_section** (`int`): 0-3 -- Source: TUI model historySection\n- **granularity** (`string`): daily, weekly, or monthly -- Source: TUI model historyGranularity\n\n## Outputs\n- **header_string** (`string`): Format: [1] Overview  [2] Performance  [3] Burn Rate  [4] Alerts  |  [D]aily / [W]eekly / [M]onthly  |  Tab:Dashboard  q:Quit -- Dest: TUI View output\n\n## Constraints\n- Consistent with existing TUI styling patterns\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"history-header-rendering\",\"files_scope\":[\"internal/tui/history.go\",\"internal/tui/history_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"history_section\",\"type\":\"int\",\"constraints\":\"0-3\",\"source\":\"TUI model historySection\"},{\"name\":\"granularity\",\"type\":\"string\",\"constraints\":\"daily, weekly, or monthly\",\"source\":\"TUI model historyGranularity\"}],\"outputs\":[{\"name\":\"header_string\",\"type\":\"string\",\"constraints\":\"Format: [1] Overview  [2] Performance  [3] Burn Rate  [4] Alerts  |  [D]aily / [W]eekly / [M]onthly  |  Tab:Dashboard  q:Quit\",\"destination\":\"TUI View output\"}]}}","acceptance_criteria":"- On sub-tabs 1-3, header shows all 4 sub-tab labels with active one visually highlighted and granularity section with active mode highlighted\n- On sub-tab 4, granularity section is replaced with /:Filter\n- Header format matches: [1] Overview  [2] Performance  [3] Burn Rate  [4] Alerts  |  [D]aily / [W]eekly / [M]onthly  |  Tab:Dashboard  q:Quit\n- go test ./internal/tui/... -run TestHistory passes with 0 failures","notes":"FR-016. This is the visual header for the redesigned history view.","status":"open","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-21T17:12:59Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:13:54Z","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-v63.12","depends_on_id":"cc-top-v63","type":"parent-child","created_at":"2026-02-21T17:12:58Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-v63.12","depends_on_id":"cc-top-v63.10","type":"blocks","created_at":"2026-02-21T17:13:30Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-v63.13","title":"Implement table rendering for all four history sub-tabs","description":"Each history sub-tab renders a table with the correct columns: Overview (9 columns), Performance (9 columns), Burn Rate (6 columns), Alerts (5 columns), with empty-state messages when no data exists and a persistence-disabled message when HistoryProvider is nil.\n\n## Inputs\n- **history_data** (`HistoryProvider query results`): May be empty, may be nil provider -- Source: HistoryProvider methods\n- **granularity** (`string`): daily, weekly, monthly -- Source: TUI model historyGranularity\n\n## Outputs\n- **rendered_table** (`string`): Lipgloss-styled table output -- Dest: TUI View output\n\n## Constraints\n- Timestamps displayed in local timezone\n- Daily_summaries fallback rows show '--' for unavailable columns\n- Default query parameters: daily=7 days, weekly=28 days, monthly=90 days\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"history-subtab-rendering\",\"files_scope\":[\"internal/tui/history.go\",\"internal/tui/history_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"history_data\",\"type\":\"HistoryProvider query results\",\"constraints\":\"May be empty, may be nil provider\",\"source\":\"HistoryProvider methods\"},{\"name\":\"granularity\",\"type\":\"string\",\"constraints\":\"daily, weekly, monthly\",\"source\":\"TUI model historyGranularity\"}],\"outputs\":[{\"name\":\"rendered_table\",\"type\":\"string\",\"constraints\":\"Lipgloss-styled table output\",\"destination\":\"TUI View output\"}]}}","acceptance_criteria":"- Overview sub-tab renders columns: Date, Cost, Tokens, Sessions, API Reqs, Errors, Lines+, Lines-, Commits (TestHistoryOverview_RendersColumns)\n- Performance sub-tab renders columns: Date, Cache%, Err Rate, Avg Lat, P50, P95, P99, Retries, Cache $ (TestHistoryPerformance_RendersColumns)\n- Burn Rate sub-tab renders columns: Date, Avg $/hr, Peak $/hr, Tokens/min, Daily $, Monthly $ (TestHistoryBurnRate_RendersColumns)\n- Alerts sub-tab renders columns: Time, Rule, Severity, Session, Message (TestHistoryAlerts_RendersColumns)\n- Nil HistoryProvider displays 'persistence is disabled' message (TestHistoryNilProvider)\n- Empty data displays sub-tab-specific messages: Overview/Performance show 'No daily statistics yet...', Burn Rate shows 'No burn rate data yet...', Alerts shows 'No alerts recorded yet...' (TestHistoryEmptyState)\n- Overview sub-tab shows '--' for columns unavailable from daily_summaries fallback data\n- Weekly and monthly granularity aggregate: counts summed, rates averaged, peaks maxed\n- go test ./internal/tui/... -run TestHistory passes with 0 failures","notes":"FR-013, FR-026, FR-027, FR-028, FR-031, FR-035, FR-040. This is the largest TUI task, covering 4 distinct table renderings plus aggregation logic.","status":"open","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":480,"created_at":"2026-02-21T17:13:01Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:13:56Z","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-v63.13","depends_on_id":"cc-top-v63","type":"parent-child","created_at":"2026-02-21T17:13:00Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-v63.13","depends_on_id":"cc-top-v63.12","type":"blocks","created_at":"2026-02-21T17:13:31Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-v63.13","depends_on_id":"cc-top-v63.7","type":"blocks","created_at":"2026-02-21T17:13:33Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-v63.14","title":"Implement detail overlays for history sub-tab rows","description":"Pressing Enter on a highlighted history row opens a full-screen detail overlay with comprehensive data; Esc or Backspace dismisses it with cursor preserved; weekly/monthly aggregate rows show a mini-table of daily rows.\n\n## Inputs\n- **selected_row** (`DailyStatsRow or BurnRateDailySummary or AlertHistoryRow`): May be empty table -- Source: History sub-tab data at historyCursor position\n- **key_event** (`tea.KeyMsg`): Enter to open, Esc or Backspace to close -- Source: Bubble Tea key dispatch\n\n## Outputs\n- **detail_view** (`string`): Full-screen, key-value pairs for scalars, tables for lists -- Dest: TUI View output\n\n## Constraints\n- Backspace must be added to handleDetailOverlayKey\n- Key-value pairs for scalar data, tables for list data (FR-030)\n- Trend column uses TrendDirection.String(): 'up', 'down', 'flat'\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"detail-overlays\",\"files_scope\":[\"internal/tui/history.go\",\"internal/tui/history_test.go\",\"internal/tui/keys.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"selected_row\",\"type\":\"DailyStatsRow or BurnRateDailySummary or AlertHistoryRow\",\"constraints\":\"May be empty table\",\"source\":\"History sub-tab data at historyCursor position\"},{\"name\":\"key_event\",\"type\":\"tea.KeyMsg\",\"constraints\":\"Enter to open, Esc or Backspace to close\",\"source\":\"Bubble Tea key dispatch\"}],\"outputs\":[{\"name\":\"detail_view\",\"type\":\"string\",\"constraints\":\"Full-screen, key-value pairs for scalars, tables for lists\",\"destination\":\"TUI View output\"}]}}","acceptance_criteria":"- Overview detail shows key-value pairs (cache efficiency, error rate, etc.) and tables (model costs, tool usage, error categories, language breakdown, decision sources) (TestHistoryOverview_RenderWithRealData)\n- Performance detail shows: model breakdown table (Model, Cost, Tokens), top tools table (Tool, Count, Avg Duration ms, P95 Duration ms), error categories table (Category, Count), MCP tool usage table (Server:Tool, Count) (TestHistoryPerformance_RenderWithRealData)\n- Burn Rate detail shows intra-day snapshots table (Time HH:MM, Cost, $/hr, Trend, Tokens/min) with Trend as 'up'/'down'/'flat' (TestHistoryBurnRate_RenderWithRealData)\n- Alert detail shows full message, rule name, severity, session ID, fired timestamp (TestHistoryAlerts_RenderWithRealData)\n- Backspace closes detail overlay and restores cursor position (TestBackspace_ClosesDetailOverlay)\n- Esc closes detail overlay and restores cursor position\n- Enter on weekly/monthly aggregate shows mini-table of daily rows for the period\n- Enter on empty table does nothing\n- go test ./internal/tui/... -run 'TestHistory|TestBackspace' passes with 0 failures","notes":"FR-017, FR-018, FR-019, FR-030, FR-038, FR-039. Backspace key added to handleDetailOverlayKey (currently only handles Esc and Enter).","status":"open","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":480,"created_at":"2026-02-21T17:13:02Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:13:57Z","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-v63.14","depends_on_id":"cc-top-v63","type":"parent-child","created_at":"2026-02-21T17:13:02Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-v63.14","depends_on_id":"cc-top-v63.13","type":"blocks","created_at":"2026-02-21T17:13:34Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-v63.15","title":"Implement alert rule filter menu on Alerts sub-tab","description":"Pressing / on the Alerts sub-tab opens a modal selection menu listing 'All' plus distinct rules from alert_history; selecting a rule filters the timeline; Esc dismisses without changing the filter; / is ignored on sub-tabs 1-3.\n\n## Inputs\n- **distinct_rules** (`list\u003cstring\u003e`): From SELECT DISTINCT rule FROM alert_history -- Source: HistoryProvider query\n- **key_events** (`tea.KeyMsg`): / to open, arrow keys to navigate, Enter to select, Esc to dismiss -- Source: Bubble Tea key dispatch\n\n## Outputs\n- **filtered_alerts** (`list\u003cAlertHistoryRow\u003e`): Filtered by selected rule or all -- Dest: Alerts sub-tab table\n\n## Constraints\n- Follows existing FilterMenuState pattern\n- Menu items from alert_history data, not engine config (FR-042)\n- / key only active on sub-tab 4 (Alerts)\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"alert-filter-menu\",\"files_scope\":[\"internal/tui/history.go\",\"internal/tui/history_test.go\",\"internal/tui/keys.go\",\"internal/tui/filter.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"distinct_rules\",\"type\":\"list\\u003cstring\\u003e\",\"constraints\":\"From SELECT DISTINCT rule FROM alert_history\",\"source\":\"HistoryProvider query\"},{\"name\":\"key_events\",\"type\":\"tea.KeyMsg\",\"constraints\":\"/ to open, arrow keys to navigate, Enter to select, Esc to dismiss\",\"source\":\"Bubble Tea key dispatch\"}],\"outputs\":[{\"name\":\"filtered_alerts\",\"type\":\"list\\u003cAlertHistoryRow\\u003e\",\"constraints\":\"Filtered by selected rule or all\",\"destination\":\"Alerts sub-tab table\"}]}}","acceptance_criteria":"- / on Alerts sub-tab opens modal menu listing 'All' plus distinct rules from alert_history data (TestHistorySlashKey_OpensFilterMenu)\n- / on sub-tabs 1-3 is ignored (TestHistorySlashKey_IgnoredOnNonAlertsTabs)\n- Esc dismisses filter menu without changing current filter\n- Selecting a rule with Enter filters the Alerts timeline to that rule only\n- Selecting 'All' shows all alerts\n- Rules from historical data that are no longer configured still appear in the menu\n- go test ./internal/tui/... -run 'TestHistorySlash' passes with 0 failures","notes":"FR-029, FR-042. Uses existing FilterMenuState pattern. Header shows /:Filter instead of granularity on Alerts sub-tab.","status":"open","priority":2,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-21T17:13:04Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:13:59Z","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-v63.15","depends_on_id":"cc-top-v63","type":"parent-child","created_at":"2026-02-21T17:13:04Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-v63.15","depends_on_id":"cc-top-v63.13","type":"blocks","created_at":"2026-02-21T17:13:36Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-v63.2","title":"Implement daily stats snapshot write operations with upsert and NaN sanitization","description":"A dailyStatsRecord writeOp upserts a row into daily_stats by date, converts latency from seconds to milliseconds, sanitizes NaN/Inf to 0.0, and stores NULL for JSON columns on marshal failure.\n\n## Inputs\n- **stats** (`stats.DashboardStats`): May contain NaN/Inf in float fields, nil or unmarshalable JSON slices -- Source: stats.Calculator.Compute()\n- **date** (`string`): YYYY-MM-DD format, non-empty -- Source: UTC wall clock at snapshot time\n\n## Outputs\n- **daily_stats_row** (`SQL row`): Exactly 1 row per date via INSERT OR REPLACE -- Dest: daily_stats table\n\n## Constraints\n- NaN/Inf sanitization occurs in the writer function, not in the stats callback\n- Latency conversion: seconds * 1000 at write, milliseconds / 1000 at read\n- Participates in existing batch transaction via writeOp pattern\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"daily-stats-write-path\",\"files_scope\":[\"internal/storage/writer.go\",\"internal/storage/store.go\",\"internal/storage/store_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"stats\",\"type\":\"stats.DashboardStats\",\"constraints\":\"May contain NaN/Inf in float fields, nil or unmarshalable JSON slices\",\"source\":\"stats.Calculator.Compute()\"},{\"name\":\"date\",\"type\":\"string\",\"constraints\":\"YYYY-MM-DD format, non-empty\",\"source\":\"UTC wall clock at snapshot time\"}],\"outputs\":[{\"name\":\"daily_stats_row\",\"type\":\"SQL row\",\"constraints\":\"Exactly 1 row per date via INSERT OR REPLACE\",\"destination\":\"daily_stats table\"}]}}","acceptance_criteria":"- Write a dailyStatsRow then query it back; all fields match (TestWriteDailyStats_RoundTrip)\n- Writing twice for the same date produces exactly 1 row with the latest values (TestWriteDailyStats_Upsert)\n- model_breakdown, top_tools, error_categories, language_breakdown, decision_sources, mcp_tool_usage round-trip through JSON correctly (TestWriteDailyStats_JSONColumns)\n- When json.Marshal fails for a JSON column, that column is stored as NULL and error is logged (TestWriteDailyStats_JSONMarshalFailure)\n- AvgAPILatency=1.5s stored as avg_api_latency_ms=1500; read back returns 1.5s (TestWriteDailyStats_LatencyConversion)\n- cache_efficiency=NaN and error_rate=Inf are stored as 0.0 (TestWriteDailyStats_NaNInfSanitizedOnWrite)\n- JSON values exceeding 1MB log a warning but are stored as-is\n- go test ./internal/storage/... -run TestWriteDailyStats passes with 0 failures","notes":"FR-004, FR-011, FR-034, FR-036, FR-041. The top_tools JSON column stores a merged struct from TopTools + ToolPerformance (FR-038).","status":"open","priority":0,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-21T17:12:40Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:13:39Z","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-v63.2","depends_on_id":"cc-top-v63","type":"parent-child","created_at":"2026-02-21T17:12:39Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-v63.2","depends_on_id":"cc-top-v63.1","type":"blocks","created_at":"2026-02-21T17:13:06Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-v63.3","title":"Implement burn rate snapshot write operations with NaN sanitization","description":"A burnRateSnapshotRecord writeOp inserts a row into burn_rate_snapshots with cost, hourly rate, trend, token velocity, projections, and per-model JSON, sanitizing NaN/Inf to 0.0.\n\n## Inputs\n- **burn_rate** (`burnrate.BurnRate`): May contain NaN/Inf in float fields, nil or unmarshalable PerModel slice -- Source: burnrate.Calculator.Compute()\n- **timestamp** (`string`): RFC 3339 UTC -- Source: time.Now().UTC()\n\n## Outputs\n- **burn_rate_snapshot_row** (`SQL row`): New row per snapshot (no upsert) -- Dest: burn_rate_snapshots table\n\n## Constraints\n- NaN/Inf sanitization occurs in the writer function, not in the burn rate callback\n- Participates in existing batch transaction via writeOp pattern\n- Trend stored as integer: 0=Flat, 1=Up, 2=Down\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"burnrate-snapshot-write-path\",\"files_scope\":[\"internal/storage/writer.go\",\"internal/storage/store.go\",\"internal/storage/store_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"burn_rate\",\"type\":\"burnrate.BurnRate\",\"constraints\":\"May contain NaN/Inf in float fields, nil or unmarshalable PerModel slice\",\"source\":\"burnrate.Calculator.Compute()\"},{\"name\":\"timestamp\",\"type\":\"string\",\"constraints\":\"RFC 3339 UTC\",\"source\":\"time.Now().UTC()\"}],\"outputs\":[{\"name\":\"burn_rate_snapshot_row\",\"type\":\"SQL row\",\"constraints\":\"New row per snapshot (no upsert)\",\"destination\":\"burn_rate_snapshots table\"}]}}","acceptance_criteria":"- Write a burnRateSnapshotRow then query it back; all fields match (TestWriteBurnRateSnapshot_RoundTrip)\n- per_model JSON round-trips correctly (TestWriteBurnRateSnapshot_PerModelJSON)\n- When json.Marshal fails for per_model, column is stored as NULL and error is logged (TestWriteBurnRateSnapshot_JSONMarshalFailure)\n- hourly_rate=NaN and daily_projection=Inf are stored as 0.0 (TestWriteBurnRateSnapshot_NaNInfSanitized)\n- go test ./internal/storage/... -run TestWriteBurnRateSnapshot passes with 0 failures","notes":"FR-007, FR-011, FR-036. Burn rate snapshots are insert-only, not upsert.","status":"open","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-21T17:12:42Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:13:41Z","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-v63.3","depends_on_id":"cc-top-v63","type":"parent-child","created_at":"2026-02-21T17:12:41Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-v63.3","depends_on_id":"cc-top-v63.1","type":"blocks","created_at":"2026-02-21T17:13:07Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-v63.4","title":"Implement alert history write operations and AlertPersister interface","description":"An alertRecord writeOp inserts a row into alert_history, and SQLiteStore implements the AlertPersister interface that the alert engine calls for each deduplicated alert.\n\n## Inputs\n- **alert** (`alerts.Alert`): Non-duplicate, contains rule, severity, message, session_id, timestamp -- Source: Alert engine deduplicated output\n- **persister** (`AlertPersister interface`): Single-method interface: PersistAlert(alert Alert) -- Source: SQLiteStore\n\n## Outputs\n- **alert_history_row** (`SQL row`): New row per alert -- Dest: alert_history table\n\n## Constraints\n- AlertPersister is a single-method interface, not merged into existing interfaces\n- PersistAlert sends writeOp via sendWrite (non-blocking, drops on full channel)\n- Engine option WithPersister(p) injects the persister\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"alert-history-write-path\",\"files_scope\":[\"internal/storage/writer.go\",\"internal/storage/store.go\",\"internal/storage/store_test.go\",\"internal/alerts/engine.go\",\"internal/alerts/engine_test.go\",\"internal/alerts/types.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"alert\",\"type\":\"alerts.Alert\",\"constraints\":\"Non-duplicate, contains rule, severity, message, session_id, timestamp\",\"source\":\"Alert engine deduplicated output\"},{\"name\":\"persister\",\"type\":\"AlertPersister interface\",\"constraints\":\"Single-method interface: PersistAlert(alert Alert)\",\"source\":\"SQLiteStore\"}],\"outputs\":[{\"name\":\"alert_history_row\",\"type\":\"SQL row\",\"constraints\":\"New row per alert\",\"destination\":\"alert_history table\"}]}}","acceptance_criteria":"- Write an alertHistoryRow then query it back; all fields match (TestWriteAlertHistory_RoundTrip)\n- Global alert with empty session_id is stored and retrieved correctly (TestWriteAlertHistory_EmptySessionID)\n- Alert engine with mock persister calls PersistAlert on deduplicated alert (TestAlertEngine_CallsPersister)\n- Alert engine with nil persister processes alerts normally without panic (TestAlertEngine_NilPersister)\n- When write channel is full, persistence is dropped and droppedWrites counter increments (TestAlertEngine_CallsPersister)\n- go test ./internal/storage/... -run TestWriteAlertHistory passes with 0 failures\n- go test ./internal/alerts/... -run TestAlertEngine passes with 0 failures","notes":"FR-010. The AlertPersister interface is defined in alerts/types.go. SQLiteStore implements it in storage/store.go.","status":"open","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-21T17:12:44Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:13:42Z","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-v63.4","depends_on_id":"cc-top-v63","type":"parent-child","created_at":"2026-02-21T17:12:43Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-v63.4","depends_on_id":"cc-top-v63.1","type":"blocks","created_at":"2026-02-21T17:13:09Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-v63.5","title":"Add retention pruning for daily_stats, burn_rate_snapshots, and alert_history","description":"The hourly maintenance cycle prunes burn_rate_snapshots older than retention_days (default 7), and daily_stats and alert_history older than summary_retention_days (default 90), using strict less-than comparison.\n\n## Inputs\n- **retention_days** (`int`): Default 7, from config -- Source: Config retention_days\n- **summary_retention_days** (`int`): Default 90, from config -- Source: Config summary_retention_days\n\n## Outputs\n- **pruned_rows** (`int`): Count of deleted rows -- Dest: Log output\n\n## Constraints\n- Uses timestamp \u003c datetime('now', '-N days') for strict less-than\n- Pruning runs during existing hourly maintenance cycle\n- Must not affect existing pruning of sessions, metrics, events, daily_summaries\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"retention-pruning-new-tables\",\"files_scope\":[\"internal/storage/maintenance.go\",\"internal/storage/maintenance_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"retention_days\",\"type\":\"int\",\"constraints\":\"Default 7, from config\",\"source\":\"Config retention_days\"},{\"name\":\"summary_retention_days\",\"type\":\"int\",\"constraints\":\"Default 90, from config\",\"source\":\"Config summary_retention_days\"}],\"outputs\":[{\"name\":\"pruned_rows\",\"type\":\"int\",\"constraints\":\"Count of deleted rows\",\"destination\":\"Log output\"}]}}","acceptance_criteria":"- burn_rate_snapshots rows older than retention_days are deleted by maintenance cycle (TestRetentionPruning_AllNewTables)\n- daily_stats rows older than summary_retention_days are deleted by maintenance cycle (TestRetentionPruning_AllNewTables)\n- alert_history rows older than summary_retention_days are deleted by maintenance cycle (TestRetentionPruning_AllNewTables)\n- Rows exactly at the retention boundary are NOT deleted (strict less-than comparison, FR-037)\n- All rows within retention period are preserved (TestRetentionPruning_AllNewTables)\n- Existing aggregation and pruning behavior for other tables is unaffected (TestMaintenanceCycle_PreservesExistingBehavior)\n- go test ./internal/storage/... -run TestRetention passes with 0 failures","notes":"FR-020, FR-021, FR-022, FR-037. Without pruning, burn rate snapshots accumulate ~288 rows/day.","status":"open","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-21T17:12:45Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:13:44Z","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-v63.5","depends_on_id":"cc-top-v63","type":"parent-child","created_at":"2026-02-21T17:12:45Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-v63.5","depends_on_id":"cc-top-v63.1","type":"blocks","created_at":"2026-02-21T17:13:11Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-v63.6","title":"Integrate stats and burn rate snapshot callbacks into SQLiteStore","description":"SQLiteStore exposes SetStatsSnapshotFunc and SetBurnRateSnapshotFunc methods, the maintenance cycle calls the stats callback to upsert daily_stats, and StartBurnRateSnapshots runs a 5-minute ticker that calls the burn rate callback.\n\n## Inputs\n- **stats_callback** (`func() stats.DashboardStats`): May be nil -- Source: Main setup via statsCalc.Compute(store.ListSessions())\n- **burnrate_callback** (`func() burnrate.BurnRate`): May be nil -- Source: Main setup via burnCalc.Compute()\n\n## Outputs\n- **daily_stats_rows** (`SQL rows`): 1 row per date per maintenance cycle -- Dest: daily_stats table\n- **burn_rate_snapshot_rows** (`SQL rows`): 1 row per 5-minute interval -- Dest: burn_rate_snapshots table\n\n## Constraints\n- Callbacks set after construction (not at NewSQLiteStore time)\n- Burn rate ticker must not start before SetBurnRateSnapshotFunc is called\n- Stats callback called during hourly maintenance cycle\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"stats-burnrate-callback-integration\",\"files_scope\":[\"internal/storage/store.go\",\"internal/storage/maintenance.go\",\"internal/storage/maintenance_test.go\",\"internal/storage/store_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"stats_callback\",\"type\":\"func() stats.DashboardStats\",\"constraints\":\"May be nil\",\"source\":\"Main setup via statsCalc.Compute(store.ListSessions())\"},{\"name\":\"burnrate_callback\",\"type\":\"func() burnrate.BurnRate\",\"constraints\":\"May be nil\",\"source\":\"Main setup via burnCalc.Compute()\"}],\"outputs\":[{\"name\":\"daily_stats_rows\",\"type\":\"SQL rows\",\"constraints\":\"1 row per date per maintenance cycle\",\"destination\":\"daily_stats table\"},{\"name\":\"burn_rate_snapshot_rows\",\"type\":\"SQL rows\",\"constraints\":\"1 row per 5-minute interval\",\"destination\":\"burn_rate_snapshots table\"}]}}","acceptance_criteria":"- Nil statsSnapshotFn causes maintenance cycle to silently skip stats capture with no error (TestNilStatsCallback_Skipped)\n- Nil burnSnapshotFn causes StartBurnRateSnapshots to return without starting a ticker (TestNilBurnRateCallback_Skipped)\n- Real stats callback during maintenance cycle produces a daily_stats row (TestStatsSnapshotViaMaintenance)\n- Real burn rate callback with ticker produces burn_rate_snapshots rows (TestBurnRateSnapshotViaTicker)\n- go test ./internal/storage/... -run 'TestNilStats|TestNilBurn|TestStatsSnapshot|TestBurnRateSnapshot' passes with 0 failures","notes":"FR-005, FR-007, FR-009. The callbacks are safe for concurrent access (Compute is pure/mutex-protected, ListSessions returns deep copies).","status":"open","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-21T17:12:47Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:13:45Z","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-v63.6","depends_on_id":"cc-top-v63","type":"parent-child","created_at":"2026-02-21T17:12:47Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-v63.6","depends_on_id":"cc-top-v63.2","type":"blocks","created_at":"2026-02-21T17:13:12Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-v63.6","depends_on_id":"cc-top-v63.3","type":"blocks","created_at":"2026-02-21T17:13:14Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-v63.7","title":"Implement query methods for daily_stats, burn_rate_snapshots, and alert_history","description":"SQLiteStore provides QueryDailyStats (merging daily_stats and daily_summaries), QueryBurnRateDailySummary, QueryBurnRateSnapshots, and QueryAlertHistory methods with correct caps, aggregation, and JSON deserialization.\n\n## Inputs\n- **days** (`int`): Positive integer -- Source: TUI granularity default: daily=7, weekly=28, monthly=90\n- **rule_filter** (`string`): Empty string for no filter, or exact rule name -- Source: Alert filter menu selection\n- **date** (`string`): YYYY-MM-DD format -- Source: Detail overlay drill-down\n\n## Outputs\n- **daily_stats_results** (`list\u003cDailyStatsRow\u003e`): Unified result from daily_stats + daily_summaries, newest first -- Dest: HistoryProvider consumer\n- **burn_rate_daily_summary** (`list\u003cBurnRateDailySummary\u003e`): Aggregated per day: avg/peak rates -- Dest: HistoryProvider consumer\n- **burn_rate_snapshots** (`list\u003cBurnRateSnapshotRow\u003e`): Max 500 rows, newest first -- Dest: HistoryProvider consumer\n- **alert_history** (`list\u003cAlertHistoryRow\u003e`): Max 200 rows, newest first -- Dest: HistoryProvider consumer\n\n## Constraints\n- Burn rate snapshot cap: 500 rows\n- Alert history cap: 200 rows\n- QueryDailyStats internally merges daily_stats and daily_summaries; TUI does not call both\n- Latency conversion on read: milliseconds / 1000 = seconds\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"query-methods-new-tables\",\"files_scope\":[\"internal/storage/query.go\",\"internal/storage/query_test.go\",\"internal/storage/store.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"days\",\"type\":\"int\",\"constraints\":\"Positive integer\",\"source\":\"TUI granularity default: daily=7, weekly=28, monthly=90\"},{\"name\":\"rule_filter\",\"type\":\"string\",\"constraints\":\"Empty string for no filter, or exact rule name\",\"source\":\"Alert filter menu selection\"},{\"name\":\"date\",\"type\":\"string\",\"constraints\":\"YYYY-MM-DD format\",\"source\":\"Detail overlay drill-down\"}],\"outputs\":[{\"name\":\"daily_stats_results\",\"type\":\"list\\u003cDailyStatsRow\\u003e\",\"constraints\":\"Unified result from daily_stats + daily_summaries, newest first\",\"destination\":\"HistoryProvider consumer\"},{\"name\":\"burn_rate_daily_summary\",\"type\":\"list\\u003cBurnRateDailySummary\\u003e\",\"constraints\":\"Aggregated per day: avg/peak rates\",\"destination\":\"HistoryProvider consumer\"},{\"name\":\"burn_rate_snapshots\",\"type\":\"list\\u003cBurnRateSnapshotRow\\u003e\",\"constraints\":\"Max 500 rows, newest first\",\"destination\":\"HistoryProvider consumer\"},{\"name\":\"alert_history\",\"type\":\"list\\u003cAlertHistoryRow\\u003e\",\"constraints\":\"Max 200 rows, newest first\",\"destination\":\"HistoryProvider consumer\"}]}}","acceptance_criteria":"- Insert 10 days of daily_stats, query 7 days, get correct 7 most recent rows (TestQueryDailyStats_ReturnsCorrectDays)\n- Invalid JSON in a daily_stats column returns zero value for that field and logs error (TestQueryDailyStats_JSONUnmarshalFailure)\n- Insert 600 burn rate snapshots, query returns 500 most recent (TestQueryBurnRateSnapshots_WithLimit)\n- Multiple snapshots per day aggregate to correct avg/peak in daily summary (TestQueryBurnRateDailySummary_Aggregation)\n- Alert query with rule filter returns only matching alerts (TestQueryAlertHistory_WithRuleFilter)\n- Insert 300 alerts, query returns 200 most recent (TestQueryAlertHistory_WithLimit)\n- Alert query with empty filter returns all alerts up to 200 (TestQueryAlertHistory_NoFilter)\n- QueryDailyStats merges daily_stats and daily_summaries: daily_stats rows show all columns, daily_summaries rows show available columns with unavailable columns marked (TestHistoryOverview_MergesLegacyAndNewData)\n- Latency values read back as seconds (divided by 1000 from stored milliseconds)\n- go test ./internal/storage/... -run 'TestQuery' passes with 0 failures","notes":"FR-012, FR-023, FR-024, FR-034, FR-035. The merge logic for Overview is presence-based: daily_stats row takes priority; daily_summaries is fallback.","status":"open","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":480,"created_at":"2026-02-21T17:12:49Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:13:47Z","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-v63.7","depends_on_id":"cc-top-v63","type":"parent-child","created_at":"2026-02-21T17:12:49Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-v63.7","depends_on_id":"cc-top-v63.2","type":"blocks","created_at":"2026-02-21T17:13:15Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-v63.7","depends_on_id":"cc-top-v63.3","type":"blocks","created_at":"2026-02-21T17:13:17Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-v63.7","depends_on_id":"cc-top-v63.4","type":"blocks","created_at":"2026-02-21T17:13:18Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-v63.8","title":"Reorder shutdown sequence to capture final snapshots before closing","description":"The Close() method follows the exact sequence: stop burn rate ticker (5s timeout), capture final burn rate snapshot via sendFinalWrite, capture final stats snapshot via sendFinalWrite, set closed=true, cancel maintenance (30s timeout), close write channel, drain writer (10s timeout), run daily aggregation, close database.\n\n## Inputs\n- **callbacks** (`func() stats.DashboardStats and func() burnrate.BurnRate`): May be nil or may hang -- Source: Previously set via Set*SnapshotFunc\n- **write_channel** (`chan writeOp`): Capacity 1000, may be full -- Source: SQLiteStore internal\n\n## Outputs\n- **final_snapshots** (`SQL rows`): 1 daily_stats row + 1 burn_rate_snapshot row if callbacks set and not hung -- Dest: SQLite database\n\n## Constraints\n- sendFinalWrite MUST NOT check the closed flag\n- sendFinalWrite MUST use blocking send with 1-second timeout (not select/default drop pattern)\n- Exact ordering per FR-033 is mandatory\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"shutdown-sequence-reorder\",\"files_scope\":[\"internal/storage/store.go\",\"internal/storage/shutdown_test.go\",\"internal/storage/store_test.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"callbacks\",\"type\":\"func() stats.DashboardStats and func() burnrate.BurnRate\",\"constraints\":\"May be nil or may hang\",\"source\":\"Previously set via Set*SnapshotFunc\"},{\"name\":\"write_channel\",\"type\":\"chan writeOp\",\"constraints\":\"Capacity 1000, may be full\",\"source\":\"SQLiteStore internal\"}],\"outputs\":[{\"name\":\"final_snapshots\",\"type\":\"SQL rows\",\"constraints\":\"1 daily_stats row + 1 burn_rate_snapshot row if callbacks set and not hung\",\"destination\":\"SQLite database\"}]}}","acceptance_criteria":"- Close() with both callbacks set produces final snapshots in both tables (TestShutdownCapturesFinalSnapshots)\n- Shutdown sequence: burn rate ticker stopped, both snapshots enqueued before closed=true, no writes rejected due to closed flag (TestShutdownSequence_FinalSnapshotsBeforeClose)\n- sendFinalWrite with full write channel blocks for up to 1 second then drops with counter increment (TestShutdownFinalWrite_ChannelAtCapacity)\n- Hung burn rate callback times out after 5 seconds and shutdown continues with stats snapshot still captured\n- Session shorter than 5 minutes produces at least one burn rate snapshot from shutdown capture\n- go test ./internal/storage/... -run 'TestShutdown' passes with 0 failures","notes":"FR-006, FR-008, FR-033. This modifies the existing Close() method. Regression test must verify existing behavior (maintenance cancel, writer drain) still works.","status":"open","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":240,"created_at":"2026-02-21T17:12:51Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:13:48Z","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-v63.8","depends_on_id":"cc-top-v63","type":"parent-child","created_at":"2026-02-21T17:12:51Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-v63.8","depends_on_id":"cc-top-v63.6","type":"blocks","created_at":"2026-02-21T17:13:19Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-v63.9","title":"Define HistoryProvider interface and implement adapter in SQLiteStore","description":"A HistoryProvider interface with 4 query methods exists, SQLiteStore implements it, and the TUI model accepts it via WithHistoryProvider option.\n\n## Inputs\n- **query_methods** (`Go methods`): QueryDailyStats, QueryBurnRateDailySummary, QueryBurnRateSnapshots, QueryAlertHistory -- Source: query-methods-new-tables task output\n\n## Outputs\n- **history_provider_interface** (`Go interface`): Separate from StateProvider, 4 methods -- Dest: internal/tui/ package\n- **with_history_provider_option** (`Go functional option`): WithHistoryProvider(p HistoryProvider) -- Dest: TUI model constructor\n\n## Constraints\n- HistoryProvider is a separate interface, not merged into StateProvider\n- Maintains separation of concerns with other 7 provider interfaces\n","design":"{\"_template\":{\"version\":\"0.2.0\",\"task_id\":\"history-provider-interface\",\"files_scope\":[\"internal/tui/model.go\",\"internal/tui/history.go\",\"internal/storage/store.go\"],\"effects\":\"\",\"inputs\":[{\"name\":\"query_methods\",\"type\":\"Go methods\",\"constraints\":\"QueryDailyStats, QueryBurnRateDailySummary, QueryBurnRateSnapshots, QueryAlertHistory\",\"source\":\"query-methods-new-tables task output\"}],\"outputs\":[{\"name\":\"history_provider_interface\",\"type\":\"Go interface\",\"constraints\":\"Separate from StateProvider, 4 methods\",\"destination\":\"internal/tui/ package\"},{\"name\":\"with_history_provider_option\",\"type\":\"Go functional option\",\"constraints\":\"WithHistoryProvider(p HistoryProvider)\",\"destination\":\"TUI model constructor\"}]}}","acceptance_criteria":"- HistoryProvider interface is defined with QueryDailyStats, QueryBurnRateDailySummary, QueryBurnRateSnapshots, QueryAlertHistory methods\n- SQLiteStore satisfies the HistoryProvider interface (compile-time check)\n- WithHistoryProvider option sets the provider on the TUI model\n- Nil HistoryProvider is accepted without panic\n- go build ./... succeeds with no errors","notes":"FR-013 setup. This is the interface plumbing between storage and TUI layers.","status":"open","priority":1,"issue_type":"task","owner":"riabtchuk@gmail.com","estimated_minutes":60,"created_at":"2026-02-21T17:12:53Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-21T17:13:50Z","labels":["taskval-managed"],"dependencies":[{"issue_id":"cc-top-v63.9","depends_on_id":"cc-top-v63","type":"parent-child","created_at":"2026-02-21T17:12:52Z","created_by":"Igor Ryabchuk","metadata":"{}"},{"issue_id":"cc-top-v63.9","depends_on_id":"cc-top-v63.7","type":"blocks","created_at":"2026-02-21T17:13:21Z","created_by":"Igor Ryabchuk","metadata":"{}"}]}
{"id":"cc-top-yqx","title":"Fix double cost counting in state store","description":"state/store.go accumulates cost from BOTH cost.usage metrics (via AddMetric delta at line ~154) AND api_request event cost_usd attribute (via AddEvent at lines 193-198). If both metrics and events arrive for the same session, costs are doubled. Fix: choose one authoritative source. The spec lists cost.usage metric as the source for burn rate. Remove the cost accumulation from AddEvent, or deduplicate.","status":"closed","priority":1,"issue_type":"bug","owner":"riabtchuk@gmail.com","created_at":"2026-02-15T04:21:47Z","created_by":"Igor Ryabchuk","updated_at":"2026-02-15T04:43:26Z","closed_at":"2026-02-15T04:43:26Z","close_reason":"Fixed by parallel agent team"}
